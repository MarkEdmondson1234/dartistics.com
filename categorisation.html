<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Categorisation</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DARTISTICS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Overview
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="example1.html">Example: Trending</a>
    </li>
    <li>
      <a href="example2.html">Example: Data Explorer</a>
    </li>
    <li>
      <a href="example3.html">Example: Venn Diagram</a>
    </li>
    <li>
      <a href="example4.html">Example: GA Effect</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    The Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="whatisr.html">What Is R?</a>
    </li>
    <li>
      <a href="rstudio.html">RStudio</a>
    </li>
    <li>
      <a href="packages.html">Packages</a>
    </li>
    <li>
      <a href="basics-base_r.html">Basics of Base R</a>
    </li>
    <li>
      <a href="exercise1-thebasics.html">Exercise: The Basic Basics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    I/O
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">WORKING WITH FILES</li>
    <li>
      <a href="import-csv-excel.html">CSV import</a>
    </li>
    <li>
      <a href="excel.html">Microsoft Excel(!)</a>
    </li>
    <li>
      <a href="exercise2-io.html">Exercise: I/O</a>
    </li>
    <li class="dropdown-header">WORKING WITH APIs</li>
    <li>
      <a href="api-google-analytics.html">Google Analytics</a>
    </li>
    <li>
      <a href="api-adobe-analytics.html">Adobe Analytics</a>
    </li>
    <li>
      <a href="api-other.html">Other APIs</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Structures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R CLASSES AND SYNTAX</li>
    <li>
      <a href="classes.html">R Classes</a>
    </li>
    <li>
      <a href="accessing.html">Accessing elements</a>
    </li>
    <li>
      <a href="exercise3-accessing-data.html">Exercise: Accessing Data</a>
    </li>
    <li class="dropdown-header">BASE R vs. TIDY</li>
    <li>
      <a href="tidyverse.html">Tidy data / Tidyverse</a>
    </li>
    <li>
      <a href="dplyr.html">dplyr()</a>
    </li>
    <li>
      <a href="exercise4-tidy-dplyr.html">Exercise: Tidy Data / dplyr</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="modelling-intro.html">Introduction</a>
    </li>
    <li>
      <a href="correlation.html">Correlation</a>
    </li>
    <li>
      <a href="regression.html">Regression</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series</a>
    </li>
    <li>
      <a href="categorisation.html">Categorisation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Output
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="viz-options.html">Visualisation Options</a>
    </li>
    <li>
      <a href="base-plots.html">Base Plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2()</a>
    </li>
    <li>
      <a href="htmlwidgets.html">htmlwidgets()</a>
    </li>
    <li>
      <a href="rmarkdown-shiny.html">RMarkdown + Shiny</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="key-topics.html">Key topics</a>
    </li>
    <li>
      <a href="github.html">GitHub</a>
    </li>
    <li>
      <a href="habits.html">Good Habits</a>
    </li>
    <li>
      <a href="going-further.html">Going further</a>
    </li>
    <li>
      <a href="resources.html">R Linkfest</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-N4DF7T"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N4DF7T');</script>
<!-- End Google Tag Manager -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Categorisation</h1>

</div>


<p>Categorisation is another useful application for web data you can perform in R.</p>
<p>In this case, we are looking to how we can classify web data to create different segments created by the data (as opposed to what you may pick), or if you give categories to R if they can help you define those categories via other metrics.</p>
<div id="decision-trees" class="section level2">
<h2>Decision trees</h2>
<p>Decision trees are typically read top to bottom, and represent where the model thinks you can split your data. As you move down the tree, the model splits out the “best fit” branches.</p>
<p><em>This example requires having a <code>web_data</code> data frame. You can either load up some sample data by completing the <a href="exercise2-io.html">I/O Exercise</a> (which is what is shown in the details below), or, if you have access to a Google Analytics account, you can use your own data by following the steps on the <a href="api-google-analytics.html">Google Analytics API page</a>.</em></p>
<p>Once you have a <code>web_data</code> data frame to work with, the command <code>head(web_data</code> should return a table that, at least structurally, looks something like this:</p>
<pre class="r"><code>kable(head(web_data))</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">X</th>
<th align="left">date</th>
<th align="left">channelGrouping</th>
<th align="left">deviceCategory</th>
<th align="right">sessions</th>
<th align="right">pageviews</th>
<th align="right">entrances</th>
<th align="right">bounces</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">desktop</td>
<td align="right">19</td>
<td align="right">23</td>
<td align="right">19</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">mobile</td>
<td align="right">112</td>
<td align="right">162</td>
<td align="right">112</td>
<td align="right">82</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">tablet</td>
<td align="right">24</td>
<td align="right">41</td>
<td align="right">24</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">2016-01-01</td>
<td align="left">Direct</td>
<td align="left">desktop</td>
<td align="right">133</td>
<td align="right">423</td>
<td align="right">133</td>
<td align="right">61</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">2016-01-01</td>
<td align="left">Direct</td>
<td align="left">mobile</td>
<td align="right">345</td>
<td align="right">878</td>
<td align="right">344</td>
<td align="right">172</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">2016-01-01</td>
<td align="left">Direct</td>
<td align="left">tablet</td>
<td align="right">126</td>
<td align="right">237</td>
<td align="right">126</td>
<td align="right">77</td>
</tr>
</tbody>
</table>
<p>We can then transform the data for categorization and store it in a new object called <code>cats</code>:</p>
<pre class="r"><code>library(dplyr) # data transformation
cats &lt;- web_data %&gt;% select(deviceCategory, channelGrouping, sessions)

kable(head(cats), row.names = FALSE)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">deviceCategory</th>
<th align="left">channelGrouping</th>
<th align="right">sessions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">desktop</td>
<td align="left">(Other)</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="left">mobile</td>
<td align="left">(Other)</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="left">tablet</td>
<td align="left">(Other)</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">desktop</td>
<td align="left">Direct</td>
<td align="right">133</td>
</tr>
<tr class="odd">
<td align="left">mobile</td>
<td align="left">Direct</td>
<td align="right">345</td>
</tr>
<tr class="even">
<td align="left">tablet</td>
<td align="left">Direct</td>
<td align="right">126</td>
</tr>
</tbody>
</table>
<p>With that data set, we can quickly make a categorisation tree:</p>
<pre class="r"><code>library(rpart) # creates decision trees

tree &lt;- rpart(deviceCategory ~ ., cats)
plot(tree)
text(tree)</code></pre>
<p><img src="categorisation_files/figure-html/unnamed-chunk-3-1.png" width="960" /></p>
<p>The labels are a bit obscure as they abbreviate the channel names.</p>
<p>The package <code>rpart.plot</code> makes the plots much nicer and easier to interpret:</p>
<pre class="r"><code>library(rpart.plot)  # pretty trees
rpart.plot(tree, type=1)</code></pre>
<p><img src="categorisation_files/figure-html/unnamed-chunk-4-1.png" width="960" /></p>
<p>Each node shows:</p>
<ul>
<li>the predicted class (Much worse, worse, …, Much better),</li>
<li>the predicted probability of each class,</li>
<li>the percentage of observations in the node (note not % of sessions)</li>
</ul>
<p>From this you can see from this data at a glance that for sessions under 300, Tablet traffic was not search related at all, favouring Email, Referral, Social and Video.</p>
</div>
<div id="machine-learning" class="section level1">
<h1>Machine learning</h1>
<p>Categorisation is a use case for machine learning, as it utilises self-validation checks to check your categorisatons. Two methods are talked about in more length in the blog post, <a href="http://markedmondson.me/intro-to-machine-learning-with-web-analytics-random-forests-and-k-means">“Introduction to Machine Learning with Web Analytics: Random Forests and K-Means”</a>.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
