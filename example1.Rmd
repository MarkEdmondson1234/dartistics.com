---
title: "Trending Google Analytics sessions"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Example 1: Trending Google Analytics sessions

We first load the libraries we will need later, authenticate with Google, and set the View Id we want to pull data from. 

```{r, message=FALSE, warning=FALSE}
library(googleAnalyticsR)
library(knitr)
ga_auth()

## replace with your own Google Analytics View Id
view_id <- 81416156

```

This is the actual API call.  We take advatage of Google Analytics v4's pivot function, to do some data transformation for us:

```{r, message=FALSE, warning=FALSE}
## get data, use pivot to get columns of medium sessions
trend_data <- google_analytics_4(view_id,
                                 date_range = c(Sys.Date() - 400, Sys.Date()),
                                 dimensions = c("date"),
                                 metrics = "sessions",
                                 pivots = pivot_ga4("medium","sessions"),
                                 max = -1)

## Note the medium columns created by the pivot
kable(head(trend_data))
```

Now we have the data, we transform it a little to a format suitable for the plot functions:

```{r}
## format the names
names(trend_data)
names(trend_data) <- c("Date","Total","Referral","Direct","Social")

## check the data R classes
## This time all look good - Date objects for date and numeric for the metrics
str(trend_data)
```

Looks good to try some plots:

### Base plots

Good for quick explorations, but takes arcane work to make presentable for final publication

```{r}
## make a time-series object
trend_ts <- ts(trend_data[-1], frequency = 7)
plot(Total ~ Date, data = trend_data, type = "l")
axis(1, trend_data$Date, format(trend_data$Date, "%b"))
```

### ggplot

New syntax, but consistent.  Build up your plot via geoms.

```{r}
library(ggplot2)
library(reshape2)

## change data into 'long' format
trend_long <- melt(trend_data, id = "Date")
head(trend_long)

## build up the plot
gg <- ggplot(trend_long, aes(x = Date, y = value, group = variable)) + theme_minimal()
gg <- gg + geom_line(aes(colour = variable))
gg
```

### highcharter (example of htmlwidgets)

Uses javascript libraries to render your data.  Only works in HTML, but fancy.

```{r, message=FALSE, warning=FALSE}
library(highcharter)
library(reshape2)

## change data into 'long' format
trend_long <- melt(trend_data, id = "Date")
hchart(trend_long, type = "line", x = Date, y = value, group = variable)

```
