<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Google Analytics Data Explorer</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DARTISTICS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Overview
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="example1.html">Example: Trending</a>
    </li>
    <li>
      <a href="example2.html">Example: Data Explorer</a>
    </li>
    <li>
      <a href="example3.html">Example: Venn Diagram</a>
    </li>
    <li>
      <a href="example4.html">Example: GA Effect</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    The Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="whatisr.html">What Is R?</a>
    </li>
    <li>
      <a href="rstudio.html">RStudio</a>
    </li>
    <li>
      <a href="packages.html">Packages</a>
    </li>
    <li>
      <a href="basics-base_r.html">Basics of Base R</a>
    </li>
    <li>
      <a href="exercise1-thebasics.html">Exercise: The Basic Basics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    I/O
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">WORKING WITH FILES</li>
    <li>
      <a href="import-csv-excel.html">CSV import</a>
    </li>
    <li>
      <a href="excel.html">Microsoft Excel(!)</a>
    </li>
    <li>
      <a href="exercise2-io.html">Exercise: I/O</a>
    </li>
    <li class="dropdown-header">WORKING WITH APIs</li>
    <li>
      <a href="analytics-apis.html">Analytics APIs</a>
    </li>
    <li>
      <a href="api-google-analytics.html">Google Analytics</a>
    </li>
    <li>
      <a href="api-adobe-analytics.html">Adobe Analytics</a>
    </li>
    <li>
      <a href="api-other.html">Other APIs</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Structures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R CLASSES AND SYNTAX</li>
    <li>
      <a href="classes.html">R Classes</a>
    </li>
    <li>
      <a href="accessing.html">Accessing elements</a>
    </li>
    <li>
      <a href="exercise3-accessing-data.html">Exercise: Accessing Data</a>
    </li>
    <li class="dropdown-header">BASE R vs. TIDY</li>
    <li>
      <a href="tidyverse.html">Tidy data / Tidyverse</a>
    </li>
    <li>
      <a href="dplyr.html">dplyr()</a>
    </li>
    <li>
      <a href="exercise4-tidy-dplyr.html">Exercise: Tidy Data / dplyr</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="modelling-intro.html">Introduction</a>
    </li>
    <li>
      <a href="correlation.html">Correlation</a>
    </li>
    <li>
      <a href="regression.html">Regression</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series</a>
    </li>
    <li>
      <a href="categorisation.html">Categorisation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Output
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="viz-options.html">Visualisation Options</a>
    </li>
    <li>
      <a href="base-plots.html">Base Plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2()</a>
    </li>
    <li>
      <a href="htmlwidgets.html">htmlwidgets()</a>
    </li>
    <li>
      <a href="rmarkdown-shiny.html">RMarkdown + Shiny</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="key-topics.html">Key topics</a>
    </li>
    <li>
      <a href="github.html">GitHub</a>
    </li>
    <li>
      <a href="habits.html">Good Habits</a>
    </li>
    <li>
      <a href="going-further.html">Going further</a>
    </li>
    <li>
      <a href="resources.html">R Linkfest</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-N4DF7T"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N4DF7T');</script>
<!-- End Google Tag Manager -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Google Analytics Data Explorer</h1>

</div>


<div id="example-2-google-analytics-2-d-data-explorer" class="section level2">
<h2>Example 2: Google Analytics 2-D data explorer</h2>
<p>This was Tim’s first web-based, interactive R applications. In hindsight…it was ambitious. It’s available at <a href="https://gilligan.shinyapps.io/ga_explorer_demo/" class="uri">https://gilligan.shinyapps.io/ga_explorer_demo/</a>.</p>
<div class="figure">
<img src="images/example2_ga-explorer.png" />

</div>
<p>Some keys to the underlying functionality used to build this:</p>
<ul>
<li>The <code>RGA</code> package – one of several packages available for pulling data from Google Analytics</li>
<li>The <code>shiny</code> package – Shiny is a package that makes R scripts interactive and web-based.</li>
<li>The <code>ggplot2</code> package – the visualizations are all built using the plotting capabilities of ggplot2</li>
</ul>
</div>
<div id="the-code" class="section level2">
<h2>The Code</h2>
<p>This code does <em>not</em> use best practices for coding in general or for R in particular. But…it works. And, in this case, that’s what mattered. The typical way to build Shiny apps is to have two scripts: one defines the front end (<strong>ui.R</strong>) and the other defines the behind-the-scenes work (<strong>server.R</strong>). They reference each other, and it can be confusing as to how exactly that happens.</p>
<div id="ui.r" class="section level3">
<h3>ui.R</h3>
<pre class="r"><code>library(shiny)

shinyUI(fluidPage(

  # This feels a little hacky, but the default &lt;h2&gt; is just too big.
  HTML(&#39;&lt;style type=&quot;text/css&quot;&gt;h2 {font-size: 150%;}&lt;/style&gt;&#39;),
  
  # Application title
  titlePanel(
    &quot;Traffic Explorer&quot;),
  
  fluidRow(
    column(4,wellPanel(
      
      # &#39;start&#39; is hacked to default to the last full months; this needs to be cleaned up  
      dateRangeInput(&#39;dateRange&#39;,
                     label = &#39;Select date range:&#39;,
                     start = Sys.Date()-15, end = Sys.Date()-1
      ),
      
      # Brand Selector
      uiOutput(&quot;brandSelector&quot;),
    
      # X Dimension Selector
      uiOutput(&quot;dimXSelector&quot;),
      
      # Y Dimension Selector
      uiOutput(&quot;dimYSelector&quot;),
    
       # Date Granularity
      uiOutput(&quot;granularitySelector&quot;),
           
      # Metric Selector
      uiOutput(&quot;metricSelector&quot;)
    
    )),
    
    column(8,plotOutput(&quot;plotTotal&quot;),
           hr(),
           plotOutput(&quot;plotTrends&quot;))
    )))</code></pre>
</div>
<div id="server.r" class="section level3">
<h3>server.R</h3>
<pre class="r"><code>library(shiny) # Package for making this thing run
library(RGA) # Package for getting GA data
library(ggplot2) # Package for rendering the graphics
library(dplyr) # Efficient manipulation of the data output.
library(scales) # To allow numbers to be formatted with commas and improved date formatting

# Authorize the Google Analytics account
ga_token &lt;- authorize(client.id = &quot;[insert Google Analytics API client ID]&quot;, 
                      client.secret = &quot;[insert Google Analytics API client secret]&quot;,
                      cache = &quot;token&quot;)

#########################
# Configuration and loading of options
#########################

# List of sites to choose from. This includes the name for the site as well as
# the view ID for the site. Replace the values in brackets (and the brackets) with
# site names and corresponding view IDs. This list can be as long or as short as you
# want it to be.
brandMaster &lt;- list(&quot;[Site 1 Display Name]&quot;=&quot;[View ID]&quot;,
                    &quot;[Site 2 Display Name]&quot;=&quot;[View ID]&quot;,
                    &quot;[Site 3 Display Name]&quot;=&quot;[View ID]&quot;)

########################
# No additional edits are REQUIRED after this point in order for the app to work. You certainly
# CAN make additional edits, but only the values in brackets above must have updated valued.
########################

# Define the segment snippets. This is just a matrix where each row has the group name in the 1st column,
# the individual segment name in the second column, and the segment definition in the third column.
# The segment definitions use GA&#39;s &quot;dynamic segment&quot; syntax. NOTE: the &quot;sessions::&quot; or &quot;users::&quot;
# component of the segment definition is NOT included here because that gets added later. This 
# script combines the snippets to make a segment for each &quot;box&quot; on the grid of results. Generally
# speaking, the segment snippets within any individual group should be mutually exclusive. Otherwise,
# the results will be tricky to interpret. Feel free to add additional groups/segments to this list!
segMaster &lt;- matrix(c(&quot;Paid vs. Non-Paid&quot;,&quot;Paid Traffic&quot;,
                      &quot;condition::ga:channelGrouping=~(Paid.Search)|(Display)|(Video)|(Social)|(Email)|(Other)&quot;),1,3)
segMaster &lt;- rbind(segMaster,c(&quot;Paid vs. Non-Paid&quot;,&quot;Non-Paid Traffic&quot;,
                               &quot;condition::ga:channelGrouping=~(Organic.Search)|(Direct)|(Referral)&quot;))
segMaster &lt;- rbind(segMaster,c(&quot;Device Category&quot;,&quot;Desktop&quot;,
                               &quot;condition::ga:deviceCategory==desktop&quot;))
segMaster &lt;- rbind(segMaster,c(&quot;Device Category&quot;,&quot;Tablet&quot;,
                               &quot;condition::ga:deviceCategory==tablet&quot;))
segMaster &lt;- rbind(segMaster,c(&quot;Device Category&quot;,&quot;Mobile&quot;,
                               &quot;condition::ga:deviceCategory==mobile&quot;))
segMaster &lt;- rbind(segMaster,c(&quot;New vs. Returning&quot;,&quot;New Visitors&quot;,
                               &quot;condition::ga:userType==New Visitor&quot;))
segMaster &lt;- rbind(segMaster,c(&quot;New vs. Returning&quot;,&quot;Returning Visitors&quot;,
                               &quot;condition::ga:userType==Returning Visitor&quot;))

colnames(segMaster) &lt;- c(&quot;group&quot;,&quot;segName&quot;,&quot;segDef&quot;)

# Set up the data granularity options                   
granularityMaster &lt;- list(&quot;By Day&quot;=&quot;ga:date&quot;,
                          &quot;By Week&quot;=&quot;ga:week&quot;,
                          &quot;By Month&quot;=&quot;ga:yearMonth&quot;)

# Set up the available metrics. With this version of the code, the only metrics that will be reliable
# are ones that are additive. In other words, ga:users will pull in data...but it will be misleading.
metricMaster &lt;- list(&quot;Sessions&quot;=&quot;ga:sessions&quot;,
                     &quot;Page Views&quot;=&quot;ga:pageviews&quot;,
                     &quot;Bounces&quot;=&quot;ga:bounces&quot;)

# Initialize a list that will hold the detailed data.
##### QUESTION: Is this needed? Is this where it should be? #####
allData &lt;- data.frame(brand=character(0),viewId=character(0),segment.X=character(0),
                      segment.Y=character(0), date=character(0),metric=numeric(0))

# Define the base theme for the plots. Each plot will selectively override this stuff as needed
baseTheme &lt;- theme(plot.title = element_text(face = &quot;bold&quot;, size=16, colour=&quot;gray10&quot;),
                   axis.line = element_blank(),
                   axis.text = element_text(face = &quot;bold&quot;, size = 15, colour = &quot;gray40&quot;),
                   axis.ticks = element_blank(),
                   panel.grid.major = element_blank(),
                   panel.grid.minor = element_blank(),
                   panel.border = element_blank(),
                   panel.background = element_rect(fill=&quot;gray99&quot;),
                   legend.position = &quot;none&quot;,
                   strip.background = element_blank(),
                   strip.text = element_text(face = &quot;bold&quot;, size = 15, colour = &quot;gray40&quot;))


shinyServer(function(input, output) {
  
  ######################################################################################
  # Set up Input Selectors
  ######################################################################################
  
  # Set up the list to allow the user to choose which brand/site to use
  output$brandSelector &lt;- renderUI ({
    brands &lt;- names(brandMaster)  # Grab just the brands (not the view IDs)
    defaultBrand &lt;- brands[1] # Set the brand that is selected by default as the first one in the list
    selectInput(&quot;brand&quot;, label = &quot;Choose a site:&quot;, 
                choices = brands, 
                selected = defaultBrand)
  })
  
  # Set up the list to allow the user to choose what to use for the Y dimension
  output$dimXSelector &lt;- renderUI ({
    dimOptions &lt;- unique(segMaster[,1]) 
    defaultDimX &lt;- dimOptions[1] # Set the group that is selected by default as the first one in the list
    selectInput(&quot;dimX&quot;, label = &quot;Choose the X dimension:&quot;, 
                choices = dimOptions, 
                selected = defaultDimX)
  })
  
  # Set up the list to allow the user to choose what to use for the Y dimension
  output$dimYSelector &lt;- renderUI ({
    dimOptions &lt;- unique(segMaster[,1]) 
    defaultDimY &lt;- dimOptions[2] # Set the group that is selected by default as the first one in the list
    selectInput(&quot;dimY&quot;, label = &quot;Choose the Y dimension:&quot;, 
                choices = dimOptions, 
                selected = defaultDimY)
  })
  
  # Set up the list to allow the user to choose the data granularity for the trendlines
  output$granularitySelector &lt;- renderUI ({
    granularityOptions &lt;- names(granularityMaster)  # Grab just the brands (not the view IDs)
    # Set the granularity that is selected by default as the first one in the list
    defaultGranularity &lt;- granularityOptions[1] 
    selectInput(&quot;granularity&quot;, label = &quot;Choose trendline resolution:&quot;, 
                choices = granularityOptions, 
                selected = defaultGranularity)
  })
  
  # Set up the list to allow the user to choose the metric to use for the results
  output$metricSelector &lt;- renderUI ({
    metricOptions &lt;- names(metricMaster)  # Grab just the brands (not the view IDs)
    defaultMetric &lt;- metricOptions[1] # Set the metric that is selected by default as the 1st in the list
    selectInput(&quot;metric&quot;, label = &quot;Choose metric:&quot;, 
                choices = metricOptions, 
                selected = defaultMetric)
  })
  
  #############################
  # Main function to pull the data based on selected inputs.
  #############################
  
  getDataFromGA &lt;- reactive({
    
    req(input$brand)  ########## Do I need this if I have a default value set?
    
    c.brandName &lt;- input$brand
    c.viewId &lt;- brandMaster[[input$brand]]
    c.metric &lt;- metricMaster[[input$metric]]
    c.granularity &lt;- granularityMaster[[input$granularity]]
    c.dimXlabel &lt;- input$dimX
    c.dimYlabel &lt;- input$dimY
    
    segmentNames.X &lt;- segMaster[segMaster[,&quot;group&quot;]==c.dimXlabel,2]
    segmentDefinitions.X &lt;- segMaster[segMaster[,&quot;group&quot;]==c.dimXlabel,3]
    
    segmentNames.Y &lt;- segMaster[segMaster[,&quot;group&quot;]==c.dimYlabel,2]
    segmentDefinitions.Y &lt;- segMaster[segMaster[,&quot;group&quot;]==c.dimYlabel,3]
    
    # Pull data for each segment. This is just a loop that goes through and makes successive calls to 
    # GA and then builds out the data frame with the data.
    for (j in 1:length(segmentDefinitions.X)) {
      
      # Get the segment details for the x-axis
      c.segmentName.X &lt;- segmentNames.X[j]
      c.segmentDefinition.X &lt;- segmentDefinitions.X[j]
      
      for (i in 1:length(segmentDefinitions.Y)) {
        
        # Get the segment details for the x-axis
        c.segmentName.Y &lt;- segmentNames.Y[i]
        c.segmentDefinition.Y &lt;- segmentDefinitions.Y[i]
        
        # Combine the two segments. This is, basically, the segment to get &quot;1 box&quot; on the 
        # heatmap (and the trended detail)
        c.segmentDefinition.XY &lt;- paste(c(&quot;sessions::&quot;,c.segmentDefinition.X,&quot;;&quot;,
                                          c.segmentDefinition.Y),collapse=&quot;&quot;)
        
        # Get the users who visit from that segment -- by month
        gaData &lt;- get_ga(profileId = c.viewId, 
                         start.date = input$dateRange[1], end.date = input$dateRange[2], 
                         metrics = c.metric, dimensions = c.granularity, sort = NULL, filters = NULL,
                         segment = c.segmentDefinition.XY, samplingLevel = &quot;HIGHER_PRECISION&quot;, 
                         start.index = NULL, max.results = NULL, include.empty.rows = NULL, 
                         fetch.by = NULL, ga_token)
        # Combine the data with the meta data about it
        tempData &lt;- data.frame(brand = c.brandName, viewId=c.viewId, 
                               segment.X=c.segmentName.X, segment.Y=c.segmentName.Y,
                               date = gaData[,1], metric = gaData[,2])
        # Add the data to the data frame
        allData &lt;- rbind(allData,tempData)
      }
    }
    
    # Reset the column names just to make sure they&#39;re right. The absence of this was causing
    # the last column to not be named &quot;metric&quot; in some cases, which caused issues later in the code.
    colnames(allData) &lt;- c(&quot;brand&quot;,   &quot;viewId&quot;, &quot;segment.X&quot;, &quot;segment.Y&quot;, &quot;date&quot;, &quot;metric&quot;)
    return(allData)
    
  })
  
  ###############################
  # Plot the data
  ###############################
  
  # Make the heatmap plot
  output$plotTotal &lt;- renderPlot({
    allData &lt;- getDataFromGA()
    
    #   Collapse the values to remove the monthly breakdown
    allData_total &lt;- allData %&gt;% group_by(segment.X, segment.Y) %&gt;% 
      summarise(metric = sum(metric)) %&gt;% 
      ungroup()
    
    # We&#39;re going to display the % of total, too, so going ahead and calculating
    # the total
    metricTotal &lt;- sum(allData_total$metric)
    
    # Plot the result total
    ggplot(allData_total,aes(x = segment.X, y = segment.Y, fill = metric)) +
      geom_tile() + scale_fill_gradient(low=&quot;white&quot;, high=&quot;green&quot;) + 
      geom_text(aes(fill = allData_total$metric, label = comma(allData_total$metric)), 
                size=8, colour = &quot;black&quot;, position = position_nudge(y = 0.1)) +
      geom_text(aes(fill = allData_total$metric, label = percent(allData_total$metric/metricTotal)), 
                size=6, colour = &quot;gray40&quot;, position = position_nudge(y = -0.1)) +
      labs(title = paste(c(&quot;Total &quot; ,input$metric,&quot; (&quot;,comma(sum(allData_total$metric)),&quot;)&quot;),collapse=&quot;&quot;)) +
      baseTheme + theme(panel.background = element_blank()) +
      scale_x_discrete(&quot;&quot;) +
      scale_y_discrete(&quot;&quot;)
  })
  
  # Plot trendlines for each block.
  output$plotTrends &lt;- renderPlot({
    allData &lt;- getDataFromGA()
    # Reverse the order of the y-axis factors so the facets will appear in the
    # same order as the heatmap totals above. This seemed like it was going to be
    # unbelievably messy to do... but this does it.
    allData$segment.Y &lt;- factor(allData$segment.Y, levels=rev(levels(allData$segment.Y)))
    
    ggplot(data = allData, mapping = aes(x = date, y = metric, group=1)) + 
      geom_line() +
      facet_grid(segment.Y ~ segment.X, switch=&quot;y&quot;) +
      baseTheme +
      labs(title = paste(c(input$metric,&quot; Trended &quot; ,input$granularity),collapse=&quot;&quot;)) +
      scale_y_continuous(name=&quot;&quot;, labels = comma) +
      theme(axis.title = element_blank(),axis.text.x = element_blank(), 
            strip.text.y = element_text(angle=180, hjust=1), 
            axis.text = element_text(face = &quot;plain&quot;, size = 11, colour = &quot;gray40&quot;))
  })
  
})</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
