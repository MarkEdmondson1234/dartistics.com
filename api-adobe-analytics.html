<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>The Adobe Analytics API</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/htmlwidgets-0.7/htmlwidgets.js"></script>
<link href="site_libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="site_libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="site_libs/moment-2.8.4/moment.js"></script>
<script src="site_libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="site_libs/dygraphs-binding-1.1.1.3/dygraphs.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DARTISTICS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Overview
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="example1.html">Example: Trending</a>
    </li>
    <li>
      <a href="example2.html">Example: Data Explorer</a>
    </li>
    <li>
      <a href="example3.html">Example: Venn Diagram</a>
    </li>
    <li>
      <a href="example4.html">Example: GA Effect</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    The Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="whatisr.html">What Is R?</a>
    </li>
    <li>
      <a href="rstudio.html">RStudio</a>
    </li>
    <li>
      <a href="packages.html">Packages</a>
    </li>
    <li>
      <a href="basics-base_r.html">Basics of Base R</a>
    </li>
    <li>
      <a href="exercise1-thebasics.html">Exercise: The Basic Basics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    I/O
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">WORKING WITH FILES</li>
    <li>
      <a href="import-csv-excel.html">CSV import</a>
    </li>
    <li>
      <a href="excel.html">Microsoft Excel(!)</a>
    </li>
    <li>
      <a href="exercise2-io.html">Exercise: I/O</a>
    </li>
    <li class="dropdown-header">WORKING WITH APIs</li>
    <li>
      <a href="api-google-analytics.html">Google Analytics</a>
    </li>
    <li>
      <a href="api-adobe-analytics.html">Adobe Analytics</a>
    </li>
    <li>
      <a href="api-other.html">Other APIs</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Structures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R CLASSES AND SYNTAX</li>
    <li>
      <a href="classes.html">R Classes</a>
    </li>
    <li>
      <a href="accessing.html">Accessing elements</a>
    </li>
    <li>
      <a href="exercise3-accessing-data.html">Exercise: Accessing Data</a>
    </li>
    <li class="dropdown-header">BASE R vs. TIDY</li>
    <li>
      <a href="tidyverse.html">Tidy data / Tidyverse</a>
    </li>
    <li>
      <a href="dplyr.html">dplyr()</a>
    </li>
    <li>
      <a href="exercise4-tidy-dplyr.html">Exercise: Tidy Data / dplyr</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="modelling-intro.html">Introduction</a>
    </li>
    <li>
      <a href="correlation.html">Correlation</a>
    </li>
    <li>
      <a href="regression.html">Regression</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series</a>
    </li>
    <li>
      <a href="categorisation.html">Categorisation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Output
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="viz-options.html">Visualisation Options</a>
    </li>
    <li>
      <a href="base-plots.html">Base Plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2()</a>
    </li>
    <li>
      <a href="htmlwidgets.html">htmlwidgets()</a>
    </li>
    <li>
      <a href="rmarkdown-shiny.html">RMarkdown + Shiny</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="resources.html">Useful Links</a>
    </li>
    <li>
      <a href="key-topics.html">Key topics</a>
    </li>
    <li>
      <a href="github.html">GitHub</a>
    </li>
    <li>
      <a href="habits.html">Good Habits</a>
    </li>
    <li>
      <a href="going-further.html">Going further</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-N4DF7T"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N4DF7T');</script>
<!-- End Google Tag Manager -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">The Adobe Analytics API</h1>

</div>


<p>Adobe Analytics access is supplied via Randy Zwitch’s <a href="http://randyzwitch.com/RSiteCatalyst/">RSiteCatalyst</a> library. There are <em>tons</em> of explanations and examples in the <a href="http://randyzwitch.com/RSiteCatalyst/">content that Randy created for the library</a>.</p>
<p>Authentication is a little harder to configure for Adobe so a live example is not shown here, but steps to download data are shown below.</p>
<div id="installation" class="section level1">
<h1>Installation</h1>
<pre class="r"><code>## This installs a package for downloading Adobe Analytics data
if(!require(RSiteCatalyst)) install.packages(&quot;RSiteCatalyst&quot;)</code></pre>
</div>
<div id="authentication" class="section level1">
<h1>Authentication</h1>
<p>There are two options for authenticating with Adobe Analytics. The newer way uses OAuth2, which is objectively “better” from a security and general elegance perspective, but it’s a bit more involved to set up. The older way simply relies on a couple of keys (a user name and a “secret”) and, at some point, will likely be deprecated.</p>
<div id="authentication---new" class="section level2">
<h2>Authentication - New</h2>
<p>This is the new OAuth2 method of authentication. Use this one if you can.</p>
<p>First, you will need to link your Adobe Analytics login to the Adobe ID account to use this method of signin.</p>
<div id="create-application" class="section level3">
<h3>Create Application</h3>
<p>If you have no application for your Adobe Analytics account, here is how to make one:</p>
<ol style="list-style-type: decimal">
<li>Create an app by visiting the Adobe developer console and navigating to <a href="https://marketing.adobe.com/developer/applications">Developer &gt; Applications</a></li>
<li>Select “Web Server (Authorization Code)”</li>
<li>Name the application</li>
<li>Leave the Redirect Uri field blank.</li>
</ol>
<div class="figure">
<img src="images/setting-up-adobe-application.png" />

</div>
<p>You should then see this screen to grant permission after running <code>SCAuth</code></p>
<div class="figure">
<img src="images/adobe-app-oauth-permission.png" />

</div>
</div>
</div>
<div id="authentication---old" class="section level2">
<h2>Authentication - Old</h2>
<p>This is the deprecated method and will dissappear “soon.”</p>
<p>Get the Web Service key under the Adobe Analytics Account Information page.</p>
<ul>
<li>User Name is used as the key</li>
<li>Sharted Secret is used as the secret</li>
</ul>
<div class="figure">
<img src="images/legacy-authentication-adobe.png" />

</div>
<p>If you use this method, then you authenticate via:</p>
<pre class="r"><code>library(RSiteCatalyst)

key &lt;- Sys.getenv(&quot;ADOBE_KEY_OLD&quot;)
secret &lt;- Sys.getenv(&quot;ADOBE_SECRET_OLD&quot;)

SCAuth(key, secret)</code></pre>
<div id="recording-secret-keys" class="section level3">
<h3>Recording secret keys</h3>
<p>I save these values to a <code>.Renviron</code> file in my home directory to keep them safe and call then via the commands below (this stops them being accidently put on github for example)</p>
<p>As an example, this is the <code>.Renviron</code> file in my root directory: <code>~/.Renviron</code></p>
<pre><code>ADOBE_KEY=&quot;a7xxxxx639-iih-nordic-r&quot;
ADOBE_SECRET=&quot;2eadxxxxx1495ea49&quot;
ADOBE_KEY_OLD=&quot;mark:XXXXXX&quot;
ADOBE_SECRET_OLD=&quot;74b46625xxxxx7e89dbe6e0&quot;</code></pre>
</div>
</div>
</div>
<div id="calling-adobe-analytics" class="section level1">
<h1>Calling Adobe Analytics</h1>
<p>Once you have setup your authentication method, you can call data using the below.</p>
<p>The <code>SCAuth()</code> function will open your browser or read the existing <code>auth-adobe</code> file if using the newer OAuth2 method, or return <code>[1] &quot;Credentials Saved in RSiteCatalyst Namespace.&quot;</code> if using legacy.</p>
<pre class="r"><code>library(RSiteCatalyst)

## New OAuth method
key    &lt;- Sys.getenv(&quot;ADOBE_KEY&quot;)
secret &lt;- Sys.getenv(&quot;ADOBE_SECRET&quot;)

SCAuth(key, secret, 
       company = &quot;XXXXX&quot;, 
       token.file = &quot;auth-adobe&quot;, 
       auth.method = &quot;OAUTH2&quot;)

## Old legacy method
key &lt;- Sys.getenv(&quot;ADOBE_KEY_OLD&quot;)
secret &lt;- Sys.getenv(&quot;ADOBE_SECRET_OLD&quot;)

SCAuth(key, secret)
</code></pre>
<p>You should be then able to see the report suites via:</p>
<pre class="r"><code>suites &lt;- GetReportSuites()
head(suites)</code></pre>
<div id="pulling-data-reports" class="section level2">
<h2>Pulling Data Reports</h2>
<p>There are 5 different types of Adobe Analytics reports that can be pulled out via the API:</p>
<ul>
<li>Overtime - <code>QueueOvertime()</code></li>
<li>Ranked - <code>QueueRanked()</code></li>
<li>Trended - <code>QueueTrended()</code></li>
<li>Pathing - <code>QueuePathing()</code></li>
<li>Fallout - <code>QueueFallout()</code></li>
</ul>
<p>See the characteristics of the <a href="https://marketing.adobe.com/developer/documentation/sitecatalyst-reporting/r-queueovertime">reports here</a></p>
</div>
<div id="advanced-api-fetching" class="section level2">
<h2>Advanced API fetching</h2>
<p>If you are not covered by the existing template calls, other API calls can be made via <code>SubmitJsonQueueReport</code> if you build the JSON yourself. It is suggested to use R lists and the library <code>jsonlite</code> to create these.</p>
</div>
<div id="api-response-time" class="section level2">
<h2>API response time</h2>
<ul>
<li>Response times for the API is variable</li>
<li>It can take anywhere between 10 seconds and 5 minutes or even timeout.</li>
<li>Size of the requested report doesn’t make much impact (within reason)</li>
<li>Recommend a function to wrap around API calls to retry if an error detected if used in automatic scripts.</li>
<li>The first call is most expensive - subsequent calls are cached.</li>
</ul>
</div>
</div>
<div id="demo-api-calls" class="section level1">
<h1>Demo API calls</h1>
<p>We set some common parameters here:</p>
<pre class="r"><code>date.from &lt;- &quot;2016-03-01&quot;
date.to &lt;- &quot;2016-03-8&quot;
reportsuite.id &lt;- &quot;grecodemystified&quot;</code></pre>
<div id="overtime" class="section level2">
<h2>Overtime</h2>
<p>Returns an overtime report. Or, rather, maybe this is “over time,” since it’s trending data across a time period, and we’re not paying time-and-a-half to the API to get the data.</p>
<p>This is similar to the key metrics report in that the only granularity allowed is time.</p>
<p>QueueOvertime requires a start and end date, a reportsuite ID, and a character vector of metrics.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;)

## wrap in system.time to report how long it takes
overtime.data &lt;- QueueOvertime(reportsuite.id, date.from, date.to, metrics)
head(overtime.data)</code></pre>
<p>You may also wish to set any of the 5 optional named parameters.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;)
date.granularity &lt;- &quot;hour&quot;
segment.id &lt;- &quot;Visit_Natural_Search&quot;
anomaly.detection &lt;- FALSE
data.current &lt;- TRUE
expedite &lt;- FALSE ## only can set to TRUE if you have permission

overtime.data &lt;- QueueOvertime(reportsuite.id, 
                                           date.from, date.to, 
                                           metrics,
                                           date.granularity = date.granularity,
                                           segment.id = segment.id,
                                           anomaly.detection = anomaly.detection,
                                           data.current = data.current,
                                           expedite = expedite)</code></pre>
<div id="data-format" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>knitr::kable(head(overtime.data))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">datetime</th>
<th align="left">name</th>
<th align="right">year</th>
<th align="right">month</th>
<th align="right">day</th>
<th align="right">hour</th>
<th align="left">segment.id</th>
<th align="left">segment.name</th>
<th align="right">visits</th>
<th align="right">uniquevisitors</th>
<th align="right">pageviews</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-03-01 00:00:00</td>
<td align="left">Tue. 1 Mar. 2016</td>
<td align="right">2016</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">Visit_Natural_Search</td>
<td align="left">Visits from Natural Search</td>
<td align="right">41</td>
<td align="right">41</td>
<td align="right">44</td>
</tr>
<tr class="even">
<td align="left">2016-03-01 01:00:00</td>
<td align="left">Tue. 1 Mar. 2016 (Hour 1)</td>
<td align="right">2016</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">Visit_Natural_Search</td>
<td align="left">Visits from Natural Search</td>
<td align="right">42</td>
<td align="right">42</td>
<td align="right">46</td>
</tr>
<tr class="odd">
<td align="left">2016-03-01 02:00:00</td>
<td align="left">Tue. 1 Mar. 2016 (Hour 2)</td>
<td align="right">2016</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">Visit_Natural_Search</td>
<td align="left">Visits from Natural Search</td>
<td align="right">59</td>
<td align="right">59</td>
<td align="right">79</td>
</tr>
<tr class="even">
<td align="left">2016-03-01 03:00:00</td>
<td align="left">Tue. 1 Mar. 2016 (Hour 3)</td>
<td align="right">2016</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="left">Visit_Natural_Search</td>
<td align="left">Visits from Natural Search</td>
<td align="right">62</td>
<td align="right">62</td>
<td align="right">72</td>
</tr>
<tr class="odd">
<td align="left">2016-03-01 04:00:00</td>
<td align="left">Tue. 1 Mar. 2016 (Hour 4)</td>
<td align="right">2016</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="left">Visit_Natural_Search</td>
<td align="left">Visits from Natural Search</td>
<td align="right">49</td>
<td align="right">49</td>
<td align="right">66</td>
</tr>
<tr class="even">
<td align="left">2016-03-01 05:00:00</td>
<td align="left">Tue. 1 Mar. 2016 (Hour 5)</td>
<td align="right">2016</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="left">Visit_Natural_Search</td>
<td align="left">Visits from Natural Search</td>
<td align="right">61</td>
<td align="right">61</td>
<td align="right">72</td>
</tr>
</tbody>
</table>
<pre class="r"><code>str(overtime.data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    192 obs. of  11 variables:
##  $ datetime      : POSIXct, format: &quot;2016-03-01 00:00:00&quot; &quot;2016-03-01 01:00:00&quot; ...
##  $ name          : chr  &quot;Tue.  1 Mar. 2016&quot; &quot;Tue.  1 Mar. 2016 (Hour 1)&quot; &quot;Tue.  1 Mar. 2016 (Hour 2)&quot; &quot;Tue.  1 Mar. 2016 (Hour 3)&quot; ...
##  $ year          : int  2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ...
##  $ month         : int  3 3 3 3 3 3 3 3 3 3 ...
##  $ day           : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ hour          : int  0 1 2 3 4 5 6 7 8 9 ...
##  $ segment.id    : chr  &quot;Visit_Natural_Search&quot; &quot;Visit_Natural_Search&quot; &quot;Visit_Natural_Search&quot; &quot;Visit_Natural_Search&quot; ...
##  $ segment.name  : chr  &quot;Visits from Natural Search&quot; &quot;Visits from Natural Search&quot; &quot;Visits from Natural Search&quot; &quot;Visits from Natural Search&quot; ...
##  $ visits        : num  41 42 59 62 49 61 80 91 96 62 ...
##  $ uniquevisitors: num  41 42 59 62 49 61 80 91 95 61 ...
##  $ pageviews     : num  44 46 79 72 66 72 105 108 116 72 ...</code></pre>
</div>
</div>
<div id="ranked" class="section level2">
<h2>Ranked</h2>
<p>Returns a ranked report. This is an ordered list of elements and associated metrics with no time granularity.</p>
<p>QueueRanked requires a start and end date, a reportsuite ID, a character vector of elements and a character vector of metrics.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;,&quot;event1&quot;)
elements &lt;- c(&quot;page&quot;,&quot;geoCountry&quot;,&quot;geoCity&quot;)

ranked.data &lt;- QueueRanked(reportsuite.id, date.from, date.to, metrics, elements)</code></pre>
<p>You may also wish to set any of the 6 optional named parameters. The 1.4 API only supports this for the first element specified. In the example below, selected applies to the first element, page.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;,&quot;event1&quot;,&quot;event2&quot;)
elements &lt;- c(&quot;page&quot;,&quot;geoCountry&quot;,&quot;geoCity&quot;)
top &lt;- 10
start &lt;- 10
selected &lt;- c(&quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot;,
              &quot;excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/&quot;)
segment.id &lt;- &quot;&quot;
data.current &lt;- TRUE
expedite &lt;- FALSE ## only can set to TRUE if you have permission

ranked.data &lt;- QueueRanked(reportsuite.id, 
                           date.from, date.to,
                           metrics,
                           elements,
                           top = top,
                           start = start,
                           selected = selected,
                           segment.id = segment.id,
                           data.current = data.current,
                           expedite = expedite)

unique(ranked.data$page)</code></pre>
<div id="data-format-1" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>knitr::kable(head(ranked.data))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">page</th>
<th align="left">geoCountry</th>
<th align="left">geoCity</th>
<th align="right">visits</th>
<th align="right">uniquevisitors</th>
<th align="right">pageviews</th>
<th align="right">event1</th>
<th align="right">event2</th>
<th align="left">segment.id</th>
<th align="left">segment.name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">New York (New York, United States)</td>
<td align="right">22</td>
<td align="right">22</td>
<td align="right">23</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">Houston (Texas, United States)</td>
<td align="right">12</td>
<td align="right">12</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">Los Angeles (California, United States)</td>
<td align="right">12</td>
<td align="right">11</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">San Diego (California, United States)</td>
<td align="right">11</td>
<td align="right">10</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">Seattle (Washington, United States)</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">San Francisco (California, United States)</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<pre class="r"><code>str(ranked.data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1775 obs. of  10 variables:
##  $ page          : chr  &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; ...
##  $ geoCountry    : chr  &quot;United States&quot; &quot;United States&quot; &quot;United States&quot; &quot;United States&quot; ...
##  $ geoCity       : chr  &quot;New York (New York, United States)&quot; &quot;Houston (Texas, United States)&quot; &quot;Los Angeles (California, United States)&quot; &quot;San Diego (California, United States)&quot; ...
##  $ visits        : num  22 12 12 11 8 8 8 7 7 7 ...
##  $ uniquevisitors: num  22 12 11 10 8 8 8 7 6 5 ...
##  $ pageviews     : num  23 12 13 12 8 8 8 7 7 7 ...
##  $ event1        : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ event2        : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ segment.id    : Factor w/ 1 level &quot;&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ segment.name  : Factor w/ 1 level &quot;&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<div id="trended" class="section level2">
<h2>Trended</h2>
<p>Returns a trended report. This is an ordered list of elements and associated metrics with time granularity.</p>
<p>QueueTrended requires a start and end date, a reportsuite ID, a character vector of elements and a character vector of metrics.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;,&quot;event1&quot;)
elements &lt;- c(&quot;page&quot;,&quot;geoCountry&quot;,&quot;geoCity&quot;)

trended.data &lt;- QueueTrended(reportsuite.id, date.from, date.to, metrics, elements)</code></pre>
<p>You may also wish to set any of the 7 optional named parameters. As with <code>QueueRanked()</code> the 1.4 API only supports selected for the first element specified.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;,&quot;event1&quot;)
elements &lt;- c(&quot;page&quot;,&quot;geoCountry&quot;,&quot;geoCity&quot;)
top &lt;- 100
start &lt;- 100
selected &lt;- c(&quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot;,
              &quot;excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/&quot;)
date.granularity &lt;- &quot;hour&quot;
segment.id &lt;- &quot;&quot;
data.current &lt;- TRUE
expedite &lt;- FALSE

trended.data &lt;- QueueTrended(reportsuite.id, 
                            date.from, date.to,
                            metrics,
                            elements,
                            top = top,
                            start = start,
                            selected = selected,
                            segment.id = segment.id,
                            data.current = data.current,
                            expedite = expedite)</code></pre>
<div id="data-format-2" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>## to print in table convert POSIXlt to Date 
trended.data$datetime &lt;- as.Date(trended.data$datetime)
knitr::kable(head(trended.data))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">datetime</th>
<th align="left">page</th>
<th align="left">geoCountry</th>
<th align="left">geoCity</th>
<th align="right">visits</th>
<th align="right">uniquevisitors</th>
<th align="right">pageviews</th>
<th align="right">event1</th>
<th align="left">segment.id</th>
<th align="left">segment.name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-03-01</td>
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">New York (New York, United States)</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">2016-03-01</td>
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">Charlotte (North Carolina, United States)</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">2016-03-01</td>
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">Seattle (Washington, United States)</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">2016-03-01</td>
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">Phoenix (Arizona, United States)</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">2016-03-01</td>
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">Holmesville (Ohio, United States)</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">2016-03-01</td>
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">United States</td>
<td align="left">Richmond (Virginia, United States)</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<pre class="r"><code>str(trended.data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    2648 obs. of  10 variables:
##  $ datetime      : Date, format: &quot;2016-03-01&quot; &quot;2016-03-01&quot; ...
##  $ page          : chr  &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; ...
##  $ geoCountry    : chr  &quot;United States&quot; &quot;United States&quot; &quot;United States&quot; &quot;United States&quot; ...
##  $ geoCity       : chr  &quot;New York (New York, United States)&quot; &quot;Charlotte (North Carolina, United States)&quot; &quot;Seattle (Washington, United States)&quot; &quot;Phoenix (Arizona, United States)&quot; ...
##  $ visits        : num  5 4 3 3 2 2 2 2 2 2 ...
##  $ uniquevisitors: num  5 4 3 1 2 2 2 2 2 1 ...
##  $ pageviews     : num  5 4 3 3 2 2 2 2 2 4 ...
##  $ event1        : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ segment.id    : Factor w/ 1 level &quot;&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ segment.name  : Factor w/ 1 level &quot;&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<div id="pathing" class="section level2">
<h2>Pathing</h2>
<p>Returns a pathing report. This is an ordered list of paths matching the specified pattern.</p>
<p>QueuePathing requires a start and end date, a reportsuite ID, a single element, a single metric and a pattern of element values that defined the path.</p>
<pre class="r"><code>metric &lt;- &quot;pageviews&quot;
element &lt;- &quot;page&quot;
pattern &lt;- c(&quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot;,
             &quot;::anything::&quot;,
             &quot;::anything::&quot;)

pathing.data &lt;- QueuePathing(reportsuite.id, 
                             date.from, date.to, 
                             metric, 
                             element, 
                             pattern)</code></pre>
<div id="data-format-3" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>knitr::kable(head(pathing.data))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">step.1</th>
<th align="left">step.2</th>
<th align="left">step.3</th>
<th align="right">count</th>
<th align="left">segment.id</th>
<th align="left">segment.name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">excel-tips/excel-dropdowns-done-right/</td>
<td align="left">Exited Site</td>
<td align="right">171</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">excel-tips/excel-dropdowns-done-right/</td>
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="right">12</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/</td>
<td align="left">Exited Site</td>
<td align="right">11</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">home</td>
<td align="left">Exited Site</td>
<td align="right">3</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">conferencescommunity/demystified-days-has-been-postponed/</td>
<td align="left">Exited Site</td>
<td align="right">2</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left">excel-tips/excel-dropdowns-done-right/</td>
<td align="left">home</td>
<td align="right">2</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<pre class="r"><code>str(pathing.data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    18 obs. of  6 variables:
##  $ step.1      : chr  &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; ...
##  $ step.2      : chr  &quot;excel-tips/excel-dropdowns-done-right/&quot; &quot;excel-tips/excel-dropdowns-done-right/&quot; &quot;excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/&quot; &quot;home&quot; ...
##  $ step.3      : chr  &quot;Exited Site&quot; &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;Exited Site&quot; &quot;Exited Site&quot; ...
##  $ count       : num  171 12 11 3 2 2 2 2 1 1 ...
##  $ segment.id  : Factor w/ 1 level &quot;&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ segment.name: Factor w/ 1 level &quot;&quot;: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<div id="fallout" class="section level2">
<h2>Fallout</h2>
<p>Returns a fallout report. This is a pathed list of elements, with fallout values for each.</p>
<p>QueuePathing requires a start and end date, a reportsuite ID, a single element, a character vector of metrics and a character vector of element values that defined the checkpoints.</p>
<pre class="r"><code>metrics &lt;- &quot;pageviews&quot;
element &lt;- &quot;page&quot;
checkpoints &lt;- c(&quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot;,
                 &quot;excel-tips/excel-dropdowns-done-right/&quot;,
                 &quot;excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/&quot;)

fallout.data &lt;- QueueFallout(reportsuite.id, date.from, date.to, metrics, element, checkpoints)</code></pre>
<div id="data-format-4" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>knitr::kable(head(fallout.data))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">url</th>
<th align="left">pageviews</th>
<th align="left">segment.id</th>
<th align="left">segment.name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/</td>
<td align="left"><a href="http://analyticsdemystified.com/excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges" class="uri">http://analyticsdemystified.com/excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges</a></td>
<td align="left">1692</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">excel-tips/excel-dropdowns-done-right/</td>
<td align="left"><a href="http://analyticsdemystified.com/excel-tips/excel-dropdowns-done-right" class="uri">http://analyticsdemystified.com/excel-tips/excel-dropdowns-done-right</a></td>
<td align="left">190</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/</td>
<td align="left"><a href="http://analyticsdemystified.com/excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2" class="uri">http://analyticsdemystified.com/excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2</a></td>
<td align="left">3</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<pre class="r"><code>str(fallout.data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    3 obs. of  5 variables:
##  $ name        : chr  &quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot; &quot;excel-tips/excel-dropdowns-done-right/&quot; &quot;excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/&quot;
##  $ url         : chr  &quot;http://analyticsdemystified.com/excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges&quot; &quot;http://analyticsdemystified.com/excel-tips/excel-dropdowns-done-right&quot; &quot;http://analyticsdemystified.com/excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2&quot;
##  $ pageviews   :List of 3
##   ..$ : chr &quot;1692&quot;
##   ..$ : chr &quot;190&quot;
##   ..$ : chr &quot;3&quot;
##  $ segment.id  : Factor w/ 1 level &quot;&quot;: 1 1 1
##  $ segment.name: Factor w/ 1 level &quot;&quot;: 1 1 1</code></pre>
</div>
</div>
</div>
<div id="example" class="section level1">
<h1>Example</h1>
<p>A typical project flow is:</p>
<ol style="list-style-type: decimal">
<li>Determine question to be answered via data</li>
<li>Scope out the required metrics, props, events etc.</li>
<li>Download small sample to test data is in correct format</li>
<li>Transform data to shape you need for output</li>
<li>Perform statistical modelling etc.</li>
<li>Revisit step 2 if necessary</li>
<li>Finalise output with sample data</li>
<li>Download full data if necessary</li>
<li>Automate scripts if necessary</li>
</ol>
<p>We demonstrate the above with the question “Did my TV campaign have a significant effect on my SEO traffic?”</p>
<div id="pose-the-right-question" class="section level2">
<h2>Pose the right question</h2>
<p>We want to measure if a statistical significant effect occured to our Natural Search traffic segment when a TV campaign ran from X to Y</p>
</div>
<div id="scope-out-requirements" class="section level2">
<h2>Scope out requirements</h2>
<p>We require sessions in the Natural Search traffic segment trended over time.</p>
</div>
<div id="download-sample" class="section level2">
<h2>Download sample</h2>
<pre class="r"><code>date.from &lt;- &quot;2016-01-01&quot;
date.to &lt;- &quot;2016-09-30&quot;
reportsuite.id &lt;- &quot;grecodemystified&quot;
metrics &lt;- &quot;visits&quot;
segment.id &lt;- &quot;Visit_Natural_Search&quot;
date.granularity &lt;- &quot;day&quot;

overtime.data &lt;- QueueOvertime(reportsuite.id, 
                               date.from, date.to, 
                               metrics,
                               date.granularity = date.granularity,
                               segment.id = segment.id)</code></pre>
<p>The data is in this format:</p>
<pre class="r"><code>str(overtime.data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    274 obs. of  8 variables:
##  $ datetime    : POSIXct, format: &quot;2016-01-01&quot; &quot;2016-01-02&quot; ...
##  $ name        : chr  &quot;Fri.  1 Jan. 2016&quot; &quot;Sat.  2 Jan. 2016&quot; &quot;Sun.  3 Jan. 2016&quot; &quot;Mon.  4 Jan. 2016&quot; ...
##  $ year        : int  2016 2016 2016 2016 2016 2016 2016 2016 2016 2016 ...
##  $ month       : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ day         : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ segment.id  : chr  &quot;Visit_Natural_Search&quot; &quot;Visit_Natural_Search&quot; &quot;Visit_Natural_Search&quot; &quot;Visit_Natural_Search&quot; ...
##  $ segment.name: chr  &quot;Visits from Natural Search&quot; &quot;Visits from Natural Search&quot; &quot;Visits from Natural Search&quot; &quot;Visits from Natural Search&quot; ...
##  $ visits      : num  188 247 326 993 1128 ...</code></pre>
</div>
<div id="transform-data" class="section level2">
<h2>Transform data</h2>
<p>This is usually the most involved step, but for this simple example we just need the datetime and visit columns</p>
<pre class="r"><code>## subset to columns we need
model_data &lt;- overtime.data[,c(&#39;datetime&#39;, &#39;visits&#39;)]

## make datetime a Date object
model_data$datetime &lt;- as.Date(model_data$datetime)</code></pre>
<p>A quick exploratory plot:</p>
<pre class="r"><code>plot(model_data, type = &quot;l&quot;)</code></pre>
<p><img src="api-adobe-analytics_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="statistical-modelling" class="section level2">
<h2>Statistical modelling</h2>
<p>We will now use the <a href="https://google.github.io/CausalImpact/">CausalImpact</a> package to test the effect of a pretend TV campaign starting around March 10th</p>
<pre class="r"><code>## install CausalImpact if you don&#39;t already have it
## https://google.github.io/CausalImpact/

## load CausalImpact
library(CausalImpact)
## load zoo for working with timeseries
library(zoo)

## turn model_data into a zoo object to work with CausalImpact
model_zoo &lt;- zoo(model_data$visits, order.by = model_data$datetime)

## specify the before and after event segments
## assuming the TV campaign started on 3rd March, 2016
pre.period &lt;- as.Date(c(&quot;2016-02-25&quot;, &quot;2016-07-10&quot;))
post.period &lt;- as.Date(c(&quot;2016-07-11&quot;,&quot;2016-09-25&quot;))

impact &lt;- CausalImpact(model_zoo, pre.period, post.period) </code></pre>
<p>CausalImpact includes a verbal report and plot to show its findings:</p>
<pre class="r"><code>impact$report</code></pre>
<pre><code>## [1] &quot;\n\nDuring the post-intervention period, the response variable had an average value of approx. 959.71. In the absence of an intervention, we would have expected an average response of 849.12. The 95% interval of this counterfactual prediction is [725.34, 970.43]. Subtracting this prediction from the observed response yields an estimate of the causal effect the intervention had on the response variable. This effect is 110.60 with a 95% interval of [-10.72, 234.38]. For a discussion of the significance of this effect, see below.\n\nSumming up the individual data points during the post-intervention period (which can only sometimes be meaningfully interpreted), the response variable had an overall value of 73.90K. Had the intervention not taken place, we would have expected a sum of 65.38K. The 95% interval of this prediction is [55.85K, 74.72K].\n\nThe above results are given in terms of absolute numbers. In relative terms, the response variable showed an increase of +13%. The 95% interval of this percentage is [-1%, +28%].\n\nThis means that, although the intervention appears to have caused a positive effect, this effect is not statistically significant when considering the entire post-intervention period as a whole. Individual days or shorter stretches within the intervention period may of course still have had a significant effect, as indicated whenever the lower limit of the impact time series (lower plot) was above zero. The apparent effect could be the result of random fluctuations that are unrelated to the intervention. This is often the case when the intervention period is very long and includes much of the time when the effect has already worn off. It can also be the case when the intervention period is too short to distinguish the signal from the noise. Finally, failing to find a significant effect can happen when there are not enough control variables or when these variables do not correlate well with the response variable during the learning period.\n\nThe probability of obtaining this effect by chance is very small (Bayesian one-sided tail-area probability p = 0.04). This means the causal effect can be considered statistically significant.&quot;</code></pre>
<pre class="r"><code>plot(impact)</code></pre>
<p><img src="api-adobe-analytics_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="review-output" class="section level2">
<h2>Review output</h2>
<p>Many refinements to the model could be made, for instance:</p>
<ul>
<li>Also download control metrics such as direct visits, paid search that may be confounders</li>
<li>Combine the model data with TV spend data</li>
</ul>
<p>…but for now we assume the output is valuable and we want to publish.</p>
</div>
<div id="finalise-output" class="section level2">
<h2>Finalise Output</h2>
<p>For final display we use a D3 javascript library, <a href="https://rstudio.github.io/dygraphs/">Dygraphs</a>, to display the results:</p>
<pre class="r"><code>## install dygraphs if necessary
library(dygraphs)

## plot data kept in impact$series
plot_data &lt;- impact$series

dygraph(data=plot_data[,c(&#39;cum.effect&#39;, &#39;cum.effect.lower&#39;, &#39;cum.effect.upper&#39;)],
        main=&quot;Cumulative Impact of Event (95% confidence level)&quot;, group=&quot;ci&quot;) %&gt;%
  dyRangeSelector() %&gt;%
  dyEvent(x = as.Date(&quot;2016-03-10&quot;), &quot;TV Campaign&quot;) %&gt;%
  dySeries(c(&#39;cum.effect.lower&#39;, &#39;cum.effect&#39;, &#39;cum.effect.upper&#39;), label=&#39;Cumulative Effect&#39;)</code></pre>
<div id="htmlwidget-78254f84828a30a6e6e1" style="width:672px;height:480px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-78254f84828a30a6e6e1">{"x":{"attrs":{"title":"Cumulative Impact of Event (95% confidence level)","labels":["day","Cumulative Effect"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":60}},"showRangeSelector":true,"rangeSelectorHeight":40,"rangeSelectorPlotFillColor":" #A7B1C4","rangeSelectorPlotStrokeColor":"#808FAB","interactionModel":"Dygraph.Interaction.defaultModel","customBars":true,"series":{"Cumulative Effect":{"axis":"y"}}},"scale":"daily","group":"ci","annotations":[],"shadings":[],"events":[{"pos":"2016-03-10T00:00:00.000Z","label":"TV Campaign","labelLoc":"top","color":"black","strokePattern":[7,3],"axis":"x"}],"format":"date","data":[["2016-01-01T00:00:00.000Z","2016-01-02T00:00:00.000Z","2016-01-03T00:00:00.000Z","2016-01-04T00:00:00.000Z","2016-01-05T00:00:00.000Z","2016-01-06T00:00:00.000Z","2016-01-07T00:00:00.000Z","2016-01-08T00:00:00.000Z","2016-01-09T00:00:00.000Z","2016-01-10T00:00:00.000Z","2016-01-11T00:00:00.000Z","2016-01-12T00:00:00.000Z","2016-01-13T00:00:00.000Z","2016-01-14T00:00:00.000Z","2016-01-15T00:00:00.000Z","2016-01-16T00:00:00.000Z","2016-01-17T00:00:00.000Z","2016-01-18T00:00:00.000Z","2016-01-19T00:00:00.000Z","2016-01-20T00:00:00.000Z","2016-01-21T00:00:00.000Z","2016-01-22T00:00:00.000Z","2016-01-23T00:00:00.000Z","2016-01-24T00:00:00.000Z","2016-01-25T00:00:00.000Z","2016-01-26T00:00:00.000Z","2016-01-27T00:00:00.000Z","2016-01-28T00:00:00.000Z","2016-01-29T00:00:00.000Z","2016-01-30T00:00:00.000Z","2016-01-31T00:00:00.000Z","2016-02-01T00:00:00.000Z","2016-02-02T00:00:00.000Z","2016-02-03T00:00:00.000Z","2016-02-04T00:00:00.000Z","2016-02-05T00:00:00.000Z","2016-02-06T00:00:00.000Z","2016-02-07T00:00:00.000Z","2016-02-08T00:00:00.000Z","2016-02-09T00:00:00.000Z","2016-02-10T00:00:00.000Z","2016-02-11T00:00:00.000Z","2016-02-12T00:00:00.000Z","2016-02-13T00:00:00.000Z","2016-02-14T00:00:00.000Z","2016-02-15T00:00:00.000Z","2016-02-16T00:00:00.000Z","2016-02-17T00:00:00.000Z","2016-02-18T00:00:00.000Z","2016-02-19T00:00:00.000Z","2016-02-20T00:00:00.000Z","2016-02-21T00:00:00.000Z","2016-02-22T00:00:00.000Z","2016-02-23T00:00:00.000Z","2016-02-24T00:00:00.000Z","2016-02-25T00:00:00.000Z","2016-02-26T00:00:00.000Z","2016-02-27T00:00:00.000Z","2016-02-28T00:00:00.000Z","2016-02-29T00:00:00.000Z","2016-03-01T00:00:00.000Z","2016-03-02T00:00:00.000Z","2016-03-03T00:00:00.000Z","2016-03-04T00:00:00.000Z","2016-03-05T00:00:00.000Z","2016-03-06T00:00:00.000Z","2016-03-07T00:00:00.000Z","2016-03-08T00:00:00.000Z","2016-03-09T00:00:00.000Z","2016-03-10T00:00:00.000Z","2016-03-11T00:00:00.000Z","2016-03-12T00:00:00.000Z","2016-03-13T00:00:00.000Z","2016-03-14T00:00:00.000Z","2016-03-15T00:00:00.000Z","2016-03-16T00:00:00.000Z","2016-03-17T00:00:00.000Z","2016-03-18T00:00:00.000Z","2016-03-19T00:00:00.000Z","2016-03-20T00:00:00.000Z","2016-03-21T00:00:00.000Z","2016-03-22T00:00:00.000Z","2016-03-23T00:00:00.000Z","2016-03-24T00:00:00.000Z","2016-03-25T00:00:00.000Z","2016-03-26T00:00:00.000Z","2016-03-27T00:00:00.000Z","2016-03-28T00:00:00.000Z","2016-03-29T00:00:00.000Z","2016-03-30T00:00:00.000Z","2016-03-31T00:00:00.000Z","2016-04-01T00:00:00.000Z","2016-04-02T00:00:00.000Z","2016-04-03T00:00:00.000Z","2016-04-04T00:00:00.000Z","2016-04-05T00:00:00.000Z","2016-04-06T00:00:00.000Z","2016-04-07T00:00:00.000Z","2016-04-08T00:00:00.000Z","2016-04-09T00:00:00.000Z","2016-04-10T00:00:00.000Z","2016-04-11T00:00:00.000Z","2016-04-12T00:00:00.000Z","2016-04-13T00:00:00.000Z","2016-04-14T00:00:00.000Z","2016-04-15T00:00:00.000Z","2016-04-16T00:00:00.000Z","2016-04-17T00:00:00.000Z","2016-04-18T00:00:00.000Z","2016-04-19T00:00:00.000Z","2016-04-20T00:00:00.000Z","2016-04-21T00:00:00.000Z","2016-04-22T00:00:00.000Z","2016-04-23T00:00:00.000Z","2016-04-24T00:00:00.000Z","2016-04-25T00:00:00.000Z","2016-04-26T00:00:00.000Z","2016-04-27T00:00:00.000Z","2016-04-28T00:00:00.000Z","2016-04-29T00:00:00.000Z","2016-04-30T00:00:00.000Z","2016-05-01T00:00:00.000Z","2016-05-02T00:00:00.000Z","2016-05-03T00:00:00.000Z","2016-05-04T00:00:00.000Z","2016-05-05T00:00:00.000Z","2016-05-06T00:00:00.000Z","2016-05-07T00:00:00.000Z","2016-05-08T00:00:00.000Z","2016-05-09T00:00:00.000Z","2016-05-10T00:00:00.000Z","2016-05-11T00:00:00.000Z","2016-05-12T00:00:00.000Z","2016-05-13T00:00:00.000Z","2016-05-14T00:00:00.000Z","2016-05-15T00:00:00.000Z","2016-05-16T00:00:00.000Z","2016-05-17T00:00:00.000Z","2016-05-18T00:00:00.000Z","2016-05-19T00:00:00.000Z","2016-05-20T00:00:00.000Z","2016-05-21T00:00:00.000Z","2016-05-22T00:00:00.000Z","2016-05-23T00:00:00.000Z","2016-05-24T00:00:00.000Z","2016-05-25T00:00:00.000Z","2016-05-26T00:00:00.000Z","2016-05-27T00:00:00.000Z","2016-05-28T00:00:00.000Z","2016-05-29T00:00:00.000Z","2016-05-30T00:00:00.000Z","2016-05-31T00:00:00.000Z","2016-06-01T00:00:00.000Z","2016-06-02T00:00:00.000Z","2016-06-03T00:00:00.000Z","2016-06-04T00:00:00.000Z","2016-06-05T00:00:00.000Z","2016-06-06T00:00:00.000Z","2016-06-07T00:00:00.000Z","2016-06-08T00:00:00.000Z","2016-06-09T00:00:00.000Z","2016-06-10T00:00:00.000Z","2016-06-11T00:00:00.000Z","2016-06-12T00:00:00.000Z","2016-06-13T00:00:00.000Z","2016-06-14T00:00:00.000Z","2016-06-15T00:00:00.000Z","2016-06-16T00:00:00.000Z","2016-06-17T00:00:00.000Z","2016-06-18T00:00:00.000Z","2016-06-19T00:00:00.000Z","2016-06-20T00:00:00.000Z","2016-06-21T00:00:00.000Z","2016-06-22T00:00:00.000Z","2016-06-23T00:00:00.000Z","2016-06-24T00:00:00.000Z","2016-06-25T00:00:00.000Z","2016-06-26T00:00:00.000Z","2016-06-27T00:00:00.000Z","2016-06-28T00:00:00.000Z","2016-06-29T00:00:00.000Z","2016-06-30T00:00:00.000Z","2016-07-01T00:00:00.000Z","2016-07-02T00:00:00.000Z","2016-07-03T00:00:00.000Z","2016-07-04T00:00:00.000Z","2016-07-05T00:00:00.000Z","2016-07-06T00:00:00.000Z","2016-07-07T00:00:00.000Z","2016-07-08T00:00:00.000Z","2016-07-09T00:00:00.000Z","2016-07-10T00:00:00.000Z","2016-07-11T00:00:00.000Z","2016-07-12T00:00:00.000Z","2016-07-13T00:00:00.000Z","2016-07-14T00:00:00.000Z","2016-07-15T00:00:00.000Z","2016-07-16T00:00:00.000Z","2016-07-17T00:00:00.000Z","2016-07-18T00:00:00.000Z","2016-07-19T00:00:00.000Z","2016-07-20T00:00:00.000Z","2016-07-21T00:00:00.000Z","2016-07-22T00:00:00.000Z","2016-07-23T00:00:00.000Z","2016-07-24T00:00:00.000Z","2016-07-25T00:00:00.000Z","2016-07-26T00:00:00.000Z","2016-07-27T00:00:00.000Z","2016-07-28T00:00:00.000Z","2016-07-29T00:00:00.000Z","2016-07-30T00:00:00.000Z","2016-07-31T00:00:00.000Z","2016-08-01T00:00:00.000Z","2016-08-02T00:00:00.000Z","2016-08-03T00:00:00.000Z","2016-08-04T00:00:00.000Z","2016-08-05T00:00:00.000Z","2016-08-06T00:00:00.000Z","2016-08-07T00:00:00.000Z","2016-08-08T00:00:00.000Z","2016-08-09T00:00:00.000Z","2016-08-10T00:00:00.000Z","2016-08-11T00:00:00.000Z","2016-08-12T00:00:00.000Z","2016-08-13T00:00:00.000Z","2016-08-14T00:00:00.000Z","2016-08-15T00:00:00.000Z","2016-08-16T00:00:00.000Z","2016-08-17T00:00:00.000Z","2016-08-18T00:00:00.000Z","2016-08-19T00:00:00.000Z","2016-08-20T00:00:00.000Z","2016-08-21T00:00:00.000Z","2016-08-22T00:00:00.000Z","2016-08-23T00:00:00.000Z","2016-08-24T00:00:00.000Z","2016-08-25T00:00:00.000Z","2016-08-26T00:00:00.000Z","2016-08-27T00:00:00.000Z","2016-08-28T00:00:00.000Z","2016-08-29T00:00:00.000Z","2016-08-30T00:00:00.000Z","2016-08-31T00:00:00.000Z","2016-09-01T00:00:00.000Z","2016-09-02T00:00:00.000Z","2016-09-03T00:00:00.000Z","2016-09-04T00:00:00.000Z","2016-09-05T00:00:00.000Z","2016-09-06T00:00:00.000Z","2016-09-07T00:00:00.000Z","2016-09-08T00:00:00.000Z","2016-09-09T00:00:00.000Z","2016-09-10T00:00:00.000Z","2016-09-11T00:00:00.000Z","2016-09-12T00:00:00.000Z","2016-09-13T00:00:00.000Z","2016-09-14T00:00:00.000Z","2016-09-15T00:00:00.000Z","2016-09-16T00:00:00.000Z","2016-09-17T00:00:00.000Z","2016-09-18T00:00:00.000Z","2016-09-19T00:00:00.000Z","2016-09-20T00:00:00.000Z","2016-09-21T00:00:00.000Z","2016-09-22T00:00:00.000Z","2016-09-23T00:00:00.000Z","2016-09-24T00:00:00.000Z","2016-09-25T00:00:00.000Z","2016-09-26T00:00:00.000Z","2016-09-27T00:00:00.000Z","2016-09-28T00:00:00.000Z","2016-09-29T00:00:00.000Z","2016-09-30T00:00:00.000Z"],[[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[-269.936131450508,457.442059074587,1214.37791606848],[-173.740468863602,880.974332257392,1901.81174598655],[81.1985815305961,1343.43419867862,2644.21524675703],[326.840882991368,1792.79625589248,3281.70088055561],[222.416850344074,1878.19725809067,3507.13825936218],[-555.911720859076,1309.69485169792,3053.75442055441],[-1087.9379943508,895.350999749891,2879.62331239015],[-820.563023464812,1331.20291605049,3407.32511757124],[-379.237492099972,1810.00024104556,4067.35467456469],[-63.9950362396921,2278.62798961069,4760.04217863279],[279.722665715512,2708.24422706389,5344.90437129549],[287.332723890082,2776.7623453307,5539.67232892844],[-415.017743682329,2174.21308267205,5122.95073828964],[-944.985698117278,1722.60893432924,4902.4371196734],[-658.547581084305,2243.18365076765,5382.83913354525],[-256.15688745401,2751.66862858707,6042.5208765758],[181.972879219305,3258.03086101776,6541.07903303312],[461.25505413604,3662.4761123303,7042.70310357203],[349.05293335786,3701.86769620673,7248.08818972677],[-499.12464928531,3113.38770022971,6764.88706902186],[-1099.26312566636,2643.2331136734,6588.33728995183],[-693.469128774566,3006.87226046788,6938.06674366161],[-303.383239735093,3496.34132771436,7621.22427650608],[-17.1970127456589,4000.77959591095,8101.25102459767],[296.755967140518,4490.18393762657,8612.82825413017],[520.108776938054,4573.50546486705,8877.37054993576],[-123.873772162711,3993.9231396853,8342.99244949414],[-601.042572080216,3568.23831370426,7926.7351506103],[-394.600409318402,3999.51076073732,8448.4211597942],[305.753828458081,4590.64744450228,9299.69278107403],[619.144937864126,5137.67612913169,10006.4461776954],[836.502935486118,5547.84662160653,10426.616816871],[945.967551741836,5663.13054343153,10740.8512030394],[45.5229412386252,5076.45305505954,10242.0815310233],[-529.957128076465,4625.79354431873,10080.4211368657],[-269.750540201756,4881.47016473603,10371.3964463832],[27.0236184603418,5331.22097838356,10842.3262323784],[360.223796530277,5763.10425060382,11503.2237495437],[651.236516755773,6133.99934892941,11906.0684532211],[657.640635821735,6249.8237814598,12136.3149463534],[25.4247092648584,5663.57751913538,11621.2981758705],[-426.334939477762,5240.50903679151,11511.2671080182],[-280.099354681763,5608.44403430654,11831.8202546178],[-156.277192921727,6071.37646391545,12390.0696712846],[378.361579729448,6603.3790083463,12965.6578861265],[516.850358286174,6963.44042816636,13245.1506104706],[611.08015829834,7066.62135745556,13496.6198242189],[-206.694004026038,6497.80734029063,12963.7030924303],[-771.583788801974,6073.0372350947,12909.1516455428],[-295.894290017401,6419.4110691135,13255.8759027584],[16.6328804340446,6854.82194506447,13741.4618608457],[472.501385869604,7282.37524311279,14454.5968725516],[402.096956463065,7337.04947771947,14665.0202060466],[288.37267236691,7331.70845627913,14574.2654835772],[-501.294832758373,6729.22249496076,14173.9588935232],[-1266.37600432284,6234.75458158564,13899.7088659334],[-1404.39538271091,6089.20935373049,13692.3631999804],[-1149.85819014645,6429.63100153705,14080.8318515409],[-834.66803586061,6867.1779622107,14640.7567407446],[-583.946089789562,7267.68800142052,15037.2839811138],[-536.943491535523,7376.20633804801,15068.0390405911],[-1467.25174582037,6787.71132652496,14657.1570387301],[-1894.73690250906,6345.20675674727,14062.8974850801],[-1628.46102084868,6699.79326421174,14681.6988567648],[-896.802351847029,7127.3311351618,15159.3614472117],[-517.869545952795,7554.69095546176,15738.5916618521],[-331.054849522799,7996.83442745285,16121.7434617593],[-330.809084767097,8137.90503290438,16340.2896207861],[-882.597049703763,7615.11282891172,16058.2787511117],[-1250.07210646319,7195.44027904695,15907.1036318873],[-1195.75471838046,7675.66869672653,16335.101680167],[-633.166120224225,8233.74574303877,17095.4100880771],[-197.93714816522,8740.02595857583,17709.5432889703],[20.679385676427,9269.31142560058,18574.9360762571],[0.52913855863153,9456.33965240457,18782.7174618098],[-570.093087495159,8885.63713217684,18321.3277617369],[-825.234001911536,8515.84905323898,18047.0366219324],[null,null,null],[null,null,null],[null,null,null],[null,null,null],[null,null,null]]]},"evals":["attrs.interactionModel"],"jsHooks":[]}</script>
</div>
<div id="automate" class="section level2">
<h2>Automate?</h2>
<p>For automation, the script could run every day to update with the most recent web data, and pull TV campaign dates from another maintained file.</p>
<p>The results could also be made available via a JSON API using a service such as [OpenCPU], for display in other departments dashboards or similar.</p>
<p>A final step could be to alter marketing spend based on the results of the function - for instance increasing brand PPC spend for TV campaigns that have a poor effect.</p>
</div>
</div>
<div id="data-strategy-for-larger-data" class="section level1">
<h1>Data strategy for larger data</h1>
<p>It may be that the amount of data you require is more than can reasonably be gathered through the API.</p>
<p>In that instance, other strategies used are, in rough order of performance:</p>
<ol style="list-style-type: decimal">
<li>Export the raw data dump from Adobe Analytics into a database, then use R connectors for that.
<ul>
<li>R is also integrated into Spark, so Hadoop/SparkR integrations are used.</li>
</ul></li>
<li>Export Data Warehouse exports via secure FTP to a folder, then read the csv files into R.</li>
<li>Build robust scripts that retry timeouts from the API and batch and recombine data over a long period.</li>
</ol>
</div>
<div id="generating-web_data" class="section level1">
<h1>Generating web_data</h1>
<p>Throughout this site, examples and exercise use a data frame called <code>web_data</code>. That example data was initially built using Google Analytics data, and instructions for generating that data with your own Google Analytic data are on the <a href="http://www.dartistics.com/api-google-analytics.html">Google Analytics API</a> page.</p>
<p>But, you’re reading about the Adobe Analytics API here, so we can assume you might want to do these same exercises with Adobe Analytics data. To do that, we can use <strong>Last Touch Channel</strong> (Adobe) in lieu of <strong>Default Channel Grouping</strong> (Google Analytics), as well as swap out some other values for comparable dimensions and metrics. If you are not using <strong>Marketing Channels</strong> in Adobe Analytics, then you will need to adjust the code below by replacing the <code>lasttouchchannel</code> dimension with the appropriate dimension.</p>
<p>To do that, first follow the steps for one of the authentication options described earlier on this page. Once that is done, you can use the following overtime command to pull the base data.</p>
<pre class="r"><code># reportsuite.id &lt;- [uncomment this line and insert your RSID]
date.from &lt;- &quot;2016-01-01&quot;
date.to &lt;- &quot;2016-08-01&quot;
metrics &lt;- c(&quot;visits&quot;,&quot;pageviews&quot;,&quot;entries&quot;,&quot;bounces&quot;)
elements &lt;- c(&quot;mobiledevicetype&quot;,&quot;lasttouchchannel&quot;)
top &lt;- 10
date.granularity &lt;- &quot;day&quot;

web_data &lt;- QueueTrended(reportsuite.id, 
                         date.from, date.to,
                         metrics,
                         elements,
                         top = top)</code></pre>
<p>This should give us a table that looks something like this:</p>
<table>
<thead>
<tr class="header">
<th align="left">datetime</th>
<th align="left">mobiledevicetype</th>
<th align="left">lasttouchchannel</th>
<th align="right">visits</th>
<th align="right">pageviews</th>
<th align="right">entries</th>
<th align="right">bounces</th>
<th align="left">segment.id</th>
<th align="left">segment.name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">Other</td>
<td align="left">Natural Search</td>
<td align="right">2839</td>
<td align="right">13261</td>
<td align="right">2776</td>
<td align="right">1077</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Other</td>
<td align="left">Paid Search</td>
<td align="right">1499</td>
<td align="right">9755</td>
<td align="right">1479</td>
<td align="right">546</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">Other</td>
<td align="left">Direct</td>
<td align="right">1448</td>
<td align="right">6864</td>
<td align="right">1448</td>
<td align="right">802</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Other</td>
<td align="left">Natural Search-Bloomreach</td>
<td align="right">1080</td>
<td align="right">2901</td>
<td align="right">1042</td>
<td align="right">602</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">Other</td>
<td align="left">Referring Domains</td>
<td align="right">502</td>
<td align="right">2192</td>
<td align="right">479</td>
<td align="right">234</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Other</td>
<td align="left">Internal</td>
<td align="right">238</td>
<td align="right">1007</td>
<td align="right">238</td>
<td align="right">79</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>We need to do a little bit of adjustments to the data to, well, Google-ify it – make it structurally match what’s expected for the other examples on this site.</p>
<p>First, let’s drop the <code>segment.id</code> and <code>segment.name</code> columns and rename the columns:</p>
<pre class="r"><code>library(dplyr)  # We&#39;ll use the select() function from dplyr

web_data &lt;- select(web_data,-segment.id,-segment.name)
colnames(web_data) &lt;- c(&quot;date&quot;,&quot;deviceCategory&quot;,&quot;channelGrouping&quot;,&quot;sessions&quot;,
                        &quot;pageviews&quot;,&quot;entrances&quot;,&quot;bounces&quot;)</code></pre>
<p>And, now, we need to do a few additional things <em>just</em> to make the data match the sort of data that comes out of a similar query to Google Analytics, which will make the object more compatible with other examples on this site.</p>
<pre class="r"><code># Change the `date` format to be `Date` rather than `POSIXlt.`
web_data$date &lt;- as.Date(web_data$date)

# Change the `Other` value to be `Desktop` for `deviceCategory.`
web_data[web_data$deviceCategory==&quot;Other&quot;,&quot;deviceCategory&quot;] = &quot;Desktop&quot;

#Change `Natural Search` to `Organic Search` for `channelGrouping.`
web_data[web_data$channelGrouping==&quot;Natural Search&quot;,&quot;channelGrouping&quot;] = &quot;Organic Search&quot;</code></pre>
<p>This should give us a table that looks something like this:</p>
<table>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="left">deviceCategory</th>
<th align="left">channelGrouping</th>
<th align="right">sessions</th>
<th align="right">pageviews</th>
<th align="right">entrances</th>
<th align="right">bounces</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">Desktop</td>
<td align="left">Organic Search</td>
<td align="right">2839</td>
<td align="right">13261</td>
<td align="right">2776</td>
<td align="right">1077</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Desktop</td>
<td align="left">Paid Search</td>
<td align="right">1499</td>
<td align="right">9755</td>
<td align="right">1479</td>
<td align="right">546</td>
</tr>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">Desktop</td>
<td align="left">Direct</td>
<td align="right">1448</td>
<td align="right">6864</td>
<td align="right">1448</td>
<td align="right">802</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Desktop</td>
<td align="left">Natural Search-Bloomreach</td>
<td align="right">1080</td>
<td align="right">2901</td>
<td align="right">1042</td>
<td align="right">602</td>
</tr>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">Desktop</td>
<td align="left">Referring Domains</td>
<td align="right">502</td>
<td align="right">2192</td>
<td align="right">479</td>
<td align="right">234</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Desktop</td>
<td align="left">Internal</td>
<td align="right">238</td>
<td align="right">1007</td>
<td align="right">238</td>
<td align="right">79</td>
</tr>
</tbody>
</table>
<p>And, this <em>should</em> be a data frame that can now be used in other examples on this site.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
