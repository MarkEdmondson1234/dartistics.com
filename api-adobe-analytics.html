<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>The Adobe Analytics API</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DARTISTICS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="example1.html">Example: Trending</a>
    </li>
    <li>
      <a href="example2.html">Example: Data Explorer</a>
    </li>
    <li>
      <a href="example3.html">Example: Venn Diagram</a>
    </li>
    <li>
      <a href="example4.html">Example: GA Effect</a>
    </li>
    <li>
      <a href="example5.html">Example: Heatmap</a>
    </li>
    <li>
      <a href="example6.html">Example: Forecasting</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Programming
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">THE BASICS</li>
    <li>
      <a href="whatisr.html">What Is R?</a>
    </li>
    <li>
      <a href="gettingstarted.html">Getting Started</a>
    </li>
    <li>
      <a href="packages.html">Packages</a>
    </li>
    <li>
      <a href="basics-base_r.html">Basics of Base R</a>
    </li>
    <li>
      <a href="exercise1-thebasics.html">Exercise: The Basic Basics</a>
    </li>
    <li class="dropdown-header">ADVANCED TOPICS</li>
    <li>
      <a href="fast-r-code.html">Faster R code</a>
    </li>
    <li>
      <a href="functions.html">Using R functions</a>
    </li>
    <li>
      <a href="creating-packages.html">Creating R packages</a>
    </li>
    <li>
      <a href="cloud-computing.html">Cloud computing &amp; R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    I/O
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">WORKING WITH FILES</li>
    <li>
      <a href="import-csv-excel.html">CSV import</a>
    </li>
    <li>
      <a href="excel.html">Microsoft Excel(!)</a>
    </li>
    <li>
      <a href="exercise2-io.html">Exercise: I/O</a>
    </li>
    <li class="dropdown-header">WORKING WITH APIs</li>
    <li>
      <a href="api-google-analytics.html">Google Analytics</a>
    </li>
    <li>
      <a href="api-adobe-analytics.html">Adobe Analytics</a>
    </li>
    <li>
      <a href="api-other.html">Other APIs</a>
    </li>
    <li>
      <a href="creating-apis.html">Creating API libraries</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Structures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R CLASSES AND SYNTAX</li>
    <li>
      <a href="classes.html">R Classes</a>
    </li>
    <li>
      <a href="accessing.html">Accessing elements</a>
    </li>
    <li>
      <a href="learn-to-love-lists.html">Learning to love lists</a>
    </li>
    <li>
      <a href="exercise3-accessing-data.html">Exercise: Accessing Data</a>
    </li>
    <li class="dropdown-header">BASE R vs. TIDY</li>
    <li>
      <a href="tidyverse.html">Tidy data / Tidyverse</a>
    </li>
    <li>
      <a href="dplyr.html">dplyr()</a>
    </li>
    <li>
      <a href="exercise4-tidy-dplyr.html">Exercise: Tidy Data / dplyr</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Statistics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="modelling-intro.html">Introduction</a>
    </li>
    <li>
      <a href="nature-of-data.html">Nature of Data</a>
    </li>
    <li>
      <a href="cross-tab-w-chi-square.html">Chi Square</a>
    </li>
    <li>
      <a href="anova.html">ANOVA</a>
    </li>
    <li>
      <a href="correlation.html">Correlation</a>
    </li>
    <li>
      <a href="regression.html">Regression</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series</a>
    </li>
    <li>
      <a href="categorisation.html">Categorisation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Output
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="viz-options.html">Visualisation Options</a>
    </li>
    <li>
      <a href="base-plots.html">Base Plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2()</a>
    </li>
    <li>
      <a href="htmlwidgets.html">htmlwidgets()</a>
    </li>
    <li>
      <a href="rmarkdown-shiny.html">RMarkdown or Shiny?</a>
    </li>
    <li>
      <a href="advanced-rmarkdown.html">Advanced RMarkdown</a>
    </li>
    <li>
      <a href="shiny.html">Shiny</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="resources.html">Useful Links</a>
    </li>
    <li>
      <a href="key-topics.html">Key topics</a>
    </li>
    <li>
      <a href="github.html">GitHub</a>
    </li>
    <li>
      <a href="habits.html">Good Habits</a>
    </li>
    <li>
      <a href="going-further.html">Going Further</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-N4DF7T"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N4DF7T');</script>
<!-- End Google Tag Manager -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">The Adobe Analytics API</h1>

</div>


<p>Adobe Analytics access is supplied via Randy Zwitch’s <a href="http://randyzwitch.com/RSiteCatalyst/">RSiteCatalyst</a> library. There are <em>tons</em> of explanations and examples in the <a href="http://randyzwitch.com/RSiteCatalyst/">content that Randy created for the library</a>.</p>
<p>Authentication is a little harder to configure for Adobe so a live example is not shown here, but steps to download data are shown below.</p>
<div id="installation" class="section level1">
<h1>Installation</h1>
<pre class="r"><code>## This installs a package for downloading Adobe Analytics data
if(!require(RSiteCatalyst)) install.packages(&quot;RSiteCatalyst&quot;)</code></pre>
</div>
<div id="authentication" class="section level1">
<h1>Authentication</h1>
<p>There are two options for authenticating with Adobe Analytics. The newer way uses OAuth2, which is objectively “better” from a security and general elegance perspective, but it’s a bit more involved to set up. The older way simply relies on a couple of keys (a user name and a “secret”) and, at some point, will likely be deprecated.</p>
<div id="authentication---new" class="section level2">
<h2>Authentication - New</h2>
<p>This is the new OAuth2 method of authentication. Use this one if you can.</p>
<p>First, you will need to link your Adobe Analytics login to the Adobe ID account to use this method of signin.</p>
<div id="create-application" class="section level3">
<h3>Create Application</h3>
<p>If you have no application for your Adobe Analytics account, here is how to make one:</p>
<ol style="list-style-type: decimal">
<li>Create an app by visiting the Adobe developer console and navigating to <a href="https://marketing.adobe.com/developer/applications">Developer &gt; Applications</a></li>
<li>Select “Web Server (Authorization Code)”</li>
<li>Name the application</li>
<li>Leave the Redirect Uri field blank.</li>
</ol>
<div class="figure">
<img src="images/setting-up-adobe-application.png" />

</div>
<p>You should then see this screen to grant permission after running <code>SCAuth</code></p>
<div class="figure">
<img src="images/adobe-app-oauth-permission.png" />

</div>
</div>
</div>
<div id="authentication---old" class="section level2">
<h2>Authentication - Old</h2>
<p>This is the deprecated method and will dissappear “soon.”</p>
<p>Get the Web Service key under the Adobe Analytics Account Information page.</p>
<ul>
<li>User Name is used as the key</li>
<li>Sharted Secret is used as the secret</li>
</ul>
<div class="figure">
<img src="images/legacy-authentication-adobe.png" />

</div>
<p>If you use this method, then you authenticate via:</p>
<pre class="r"><code>library(RSiteCatalyst)

key &lt;- Sys.getenv(&quot;ADOBE_KEY_OLD&quot;)
secret &lt;- Sys.getenv(&quot;ADOBE_SECRET_OLD&quot;)

SCAuth(key, secret)</code></pre>
<pre><code>## Warning in SCAuth(key, secret): Check User Name. Must have
## &#39;username:company&#39; pattern</code></pre>
<pre><code>## Warning in SCAuth(key, secret): Shared Secret does not have valid number of
## characters (32)</code></pre>
<pre><code>## Error in SCAuth(key, secret): Authentication failed due to errors</code></pre>
<div id="recording-secret-keys" class="section level3">
<h3>Recording secret keys</h3>
<p>I save these values to a <code>.Renviron</code> file in my home directory to keep them safe and call then via the commands below (this stops them being accidently put on github for example)</p>
<p>As an example, this is the <code>.Renviron</code> file in my root directory: <code>~/.Renviron</code></p>
<pre><code>ADOBE_KEY=&quot;a7xxxxx639-iih-nordic-r&quot;
ADOBE_SECRET=&quot;2eadxxxxx1495ea49&quot;
ADOBE_KEY_OLD=&quot;mark:XXXXXX&quot;
ADOBE_SECRET_OLD=&quot;74b46625xxxxx7e89dbe6e0&quot;</code></pre>
</div>
</div>
</div>
<div id="calling-adobe-analytics" class="section level1">
<h1>Calling Adobe Analytics</h1>
<p>Once you have setup your authentication method, you can call data using the below.</p>
<p>The <code>SCAuth()</code> function will open your browser or read the existing <code>auth-adobe</code> file if using the newer OAuth2 method, or return <code>[1] &quot;Credentials Saved in RSiteCatalyst Namespace.&quot;</code> if using legacy.</p>
<pre class="r"><code>library(RSiteCatalyst)

## New OAuth method
key    &lt;- Sys.getenv(&quot;ADOBE_KEY&quot;)
secret &lt;- Sys.getenv(&quot;ADOBE_SECRET&quot;)

SCAuth(key, secret, 
       company = &quot;XXXXX&quot;, 
       token.file = &quot;auth-adobe&quot;, 
       auth.method = &quot;OAUTH2&quot;)

## Old legacy method
key &lt;- Sys.getenv(&quot;ADOBE_KEY_OLD&quot;)
secret &lt;- Sys.getenv(&quot;ADOBE_SECRET_OLD&quot;)

SCAuth(key, secret)
</code></pre>
<p>You should be then able to see the report suites via:</p>
<pre class="r"><code>suites &lt;- GetReportSuites()
head(suites)</code></pre>
<div id="pulling-data-reports" class="section level2">
<h2>Pulling Data Reports</h2>
<p>There are 5 different types of Adobe Analytics reports that can be pulled out via the API:</p>
<ul>
<li>Overtime - <code>QueueOvertime()</code></li>
<li>Ranked - <code>QueueRanked()</code></li>
<li>Trended - <code>QueueTrended()</code></li>
<li>Pathing - <code>QueuePathing()</code></li>
<li>Fallout - <code>QueueFallout()</code></li>
</ul>
<p>See the characteristics of the <a href="https://marketing.adobe.com/developer/documentation/sitecatalyst-reporting/r-queueovertime">reports here</a></p>
</div>
<div id="advanced-api-fetching" class="section level2">
<h2>Advanced API fetching</h2>
<p>If you are not covered by the existing template calls, other API calls can be made via <code>SubmitJsonQueueReport</code> if you build the JSON yourself. It is suggested to use R lists and the library <code>jsonlite</code> to create these.</p>
</div>
<div id="api-response-time" class="section level2">
<h2>API response time</h2>
<ul>
<li>Response times for the API is variable</li>
<li>It can take anywhere between 10 seconds and 5 minutes or even timeout.</li>
<li>Size of the requested report doesn’t make much impact (within reason)</li>
<li>Recommend a function to wrap around API calls to retry if an error detected if used in automatic scripts.</li>
<li>The first call is most expensive - subsequent calls are cached.</li>
</ul>
</div>
</div>
<div id="demo-api-calls" class="section level1">
<h1>Demo API calls</h1>
<p>We set some common parameters here:</p>
<pre class="r"><code>date.from &lt;- &quot;2016-03-01&quot;
date.to &lt;- &quot;2016-03-8&quot;
reportsuite.id &lt;- &quot;grecodemystified&quot;</code></pre>
<div id="overtime" class="section level2">
<h2>Overtime</h2>
<p>Returns an overtime report. Or, rather, maybe this is “over time,” since it’s trending data across a time period, and we’re not paying time-and-a-half to the API to get the data.</p>
<p>This is similar to the key metrics report in that the only granularity allowed is time.</p>
<p>QueueOvertime requires a start and end date, a reportsuite ID, and a character vector of metrics.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;)

## wrap in system.time to report how long it takes
overtime.data &lt;- QueueOvertime(reportsuite.id, date.from, date.to, metrics)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<pre class="r"><code>head(overtime.data)</code></pre>
<pre><code>## Error in head(overtime.data): object &#39;overtime.data&#39; not found</code></pre>
<p>You may also wish to set any of the 5 optional named parameters.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;)
date.granularity &lt;- &quot;hour&quot;
segment.id &lt;- &quot;Visit_Natural_Search&quot;
anomaly.detection &lt;- FALSE
data.current &lt;- TRUE
expedite &lt;- FALSE ## only can set to TRUE if you have permission

overtime.data &lt;- QueueOvertime(reportsuite.id, 
                                           date.from, date.to, 
                                           metrics,
                                           date.granularity = date.granularity,
                                           segment.id = segment.id,
                                           anomaly.detection = anomaly.detection,
                                           data.current = data.current,
                                           expedite = expedite)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<div id="data-format" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>knitr::kable(head(overtime.data))</code></pre>
<pre><code>## Error in head(overtime.data): object &#39;overtime.data&#39; not found</code></pre>
<pre class="r"><code>str(overtime.data)</code></pre>
<pre><code>## Error in str(overtime.data): object &#39;overtime.data&#39; not found</code></pre>
</div>
</div>
<div id="ranked" class="section level2">
<h2>Ranked</h2>
<p>Returns a ranked report. This is an ordered list of elements and associated metrics with no time granularity.</p>
<p>QueueRanked requires a start and end date, a reportsuite ID, a character vector of elements and a character vector of metrics.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;,&quot;event1&quot;)
elements &lt;- c(&quot;page&quot;,&quot;geoCountry&quot;,&quot;geoCity&quot;)

ranked.data &lt;- QueueRanked(reportsuite.id, date.from, date.to, metrics, elements)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<p>You may also wish to set any of the 6 optional named parameters. The 1.4 API only supports this for the first element specified. In the example below, selected applies to the first element, page.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;,&quot;event1&quot;,&quot;event2&quot;)
elements &lt;- c(&quot;page&quot;,&quot;geoCountry&quot;,&quot;geoCity&quot;)
top &lt;- 10
start &lt;- 10
selected &lt;- c(&quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot;,
              &quot;excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/&quot;)
segment.id &lt;- &quot;&quot;
data.current &lt;- TRUE
expedite &lt;- FALSE ## only can set to TRUE if you have permission

ranked.data &lt;- QueueRanked(reportsuite.id, 
                           date.from, date.to,
                           metrics,
                           elements,
                           top = top,
                           start = start,
                           selected = selected,
                           segment.id = segment.id,
                           data.current = data.current,
                           expedite = expedite)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<pre class="r"><code>unique(ranked.data$page)</code></pre>
<pre><code>## Error in unique(ranked.data$page): object &#39;ranked.data&#39; not found</code></pre>
<div id="data-format-1" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>knitr::kable(head(ranked.data))</code></pre>
<pre><code>## Error in head(ranked.data): object &#39;ranked.data&#39; not found</code></pre>
<pre class="r"><code>str(ranked.data)</code></pre>
<pre><code>## Error in str(ranked.data): object &#39;ranked.data&#39; not found</code></pre>
</div>
</div>
<div id="trended" class="section level2">
<h2>Trended</h2>
<p>Returns a trended report. This is an ordered list of elements and associated metrics with time granularity.</p>
<p>QueueTrended requires a start and end date, a reportsuite ID, a character vector of elements and a character vector of metrics.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;,&quot;event1&quot;)
elements &lt;- c(&quot;page&quot;,&quot;geoCountry&quot;,&quot;geoCity&quot;)

trended.data &lt;- QueueTrended(reportsuite.id, date.from, date.to, metrics, elements)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<p>You may also wish to set any of the 7 optional named parameters. As with <code>QueueRanked()</code> the 1.4 API only supports selected for the first element specified.</p>
<pre class="r"><code>metrics &lt;- c(&quot;visits&quot;,&quot;uniquevisitors&quot;,&quot;pageviews&quot;,&quot;event1&quot;)
elements &lt;- c(&quot;page&quot;,&quot;geoCountry&quot;,&quot;geoCity&quot;)
top &lt;- 100
start &lt;- 100
selected &lt;- c(&quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot;,
              &quot;excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/&quot;)
date.granularity &lt;- &quot;hour&quot;
segment.id &lt;- &quot;&quot;
data.current &lt;- TRUE
expedite &lt;- FALSE

trended.data &lt;- QueueTrended(reportsuite.id, 
                            date.from, date.to,
                            metrics,
                            elements,
                            top = top,
                            start = start,
                            selected = selected,
                            segment.id = segment.id,
                            data.current = data.current,
                            expedite = expedite)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<div id="data-format-2" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>## to print in table convert POSIXlt to Date 
trended.data$datetime &lt;- as.Date(trended.data$datetime)</code></pre>
<pre><code>## Error in as.Date(trended.data$datetime): object &#39;trended.data&#39; not found</code></pre>
<pre class="r"><code>knitr::kable(head(trended.data))</code></pre>
<pre><code>## Error in head(trended.data): object &#39;trended.data&#39; not found</code></pre>
<pre class="r"><code>str(trended.data)</code></pre>
<pre><code>## Error in str(trended.data): object &#39;trended.data&#39; not found</code></pre>
</div>
</div>
<div id="pathing" class="section level2">
<h2>Pathing</h2>
<p>Returns a pathing report. This is an ordered list of paths matching the specified pattern.</p>
<p>QueuePathing requires a start and end date, a reportsuite ID, a single element, a single metric and a pattern of element values that defined the path.</p>
<pre class="r"><code>metric &lt;- &quot;pageviews&quot;
element &lt;- &quot;page&quot;
pattern &lt;- c(&quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot;,
             &quot;::anything::&quot;,
             &quot;::anything::&quot;)

pathing.data &lt;- QueuePathing(reportsuite.id, 
                             date.from, date.to, 
                             metric, 
                             element, 
                             pattern)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<div id="data-format-3" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>knitr::kable(head(pathing.data))</code></pre>
<pre><code>## Error in head(pathing.data): object &#39;pathing.data&#39; not found</code></pre>
<pre class="r"><code>str(pathing.data)</code></pre>
<pre><code>## Error in str(pathing.data): object &#39;pathing.data&#39; not found</code></pre>
</div>
</div>
<div id="fallout" class="section level2">
<h2>Fallout</h2>
<p>Returns a fallout report. This is a pathed list of elements, with fallout values for each.</p>
<p>QueuePathing requires a start and end date, a reportsuite ID, a single element, a character vector of metrics and a character vector of element values that defined the checkpoints.</p>
<pre class="r"><code>metrics &lt;- &quot;pageviews&quot;
element &lt;- &quot;page&quot;
checkpoints &lt;- c(&quot;excel-tips/excel-dropdowns-done-right-data-validation-and-named-ranges/&quot;,
                 &quot;excel-tips/excel-dropdowns-done-right/&quot;,
                 &quot;excel-tips/excel-dynamic-named-ranges-never-manually-updating-your-charts-2/&quot;)

fallout.data &lt;- QueueFallout(reportsuite.id, date.from, date.to, metrics, element, checkpoints)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<div id="data-format-4" class="section level3">
<h3>Data format</h3>
<p>Report data is returned with the following R classes:</p>
<pre class="r"><code>knitr::kable(head(fallout.data))</code></pre>
<pre><code>## Error in head(fallout.data): object &#39;fallout.data&#39; not found</code></pre>
<pre class="r"><code>str(fallout.data)</code></pre>
<pre><code>## Error in str(fallout.data): object &#39;fallout.data&#39; not found</code></pre>
</div>
</div>
</div>
<div id="example" class="section level1">
<h1>Example</h1>
<p>A typical project flow is:</p>
<ol style="list-style-type: decimal">
<li>Determine question to be answered via data</li>
<li>Scope out the required metrics, props, events etc.</li>
<li>Download small sample to test data is in correct format</li>
<li>Transform data to shape you need for output</li>
<li>Perform statistical modelling etc.</li>
<li>Revisit step 2 if necessary</li>
<li>Finalise output with sample data</li>
<li>Download full data if necessary</li>
<li>Automate scripts if necessary</li>
</ol>
<p>We demonstrate the above with the question “Did my TV campaign have a significant effect on my SEO traffic?”</p>
<div id="pose-the-right-question" class="section level2">
<h2>Pose the right question</h2>
<p>We want to measure if a statistical significant effect occured to our Natural Search traffic segment when a TV campaign ran from X to Y</p>
</div>
<div id="scope-out-requirements" class="section level2">
<h2>Scope out requirements</h2>
<p>We require sessions in the Natural Search traffic segment trended over time.</p>
</div>
<div id="download-sample" class="section level2">
<h2>Download sample</h2>
<pre class="r"><code>date.from &lt;- &quot;2016-01-01&quot;
date.to &lt;- &quot;2016-09-30&quot;
reportsuite.id &lt;- &quot;grecodemystified&quot;
metrics &lt;- &quot;visits&quot;
segment.id &lt;- &quot;Visit_Natural_Search&quot;
date.granularity &lt;- &quot;day&quot;

overtime.data &lt;- QueueOvertime(reportsuite.id, 
                               date.from, date.to, 
                               metrics,
                               date.granularity = date.granularity,
                               segment.id = segment.id)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<p>The data is in this format:</p>
<pre class="r"><code>str(overtime.data)</code></pre>
<pre><code>## Error in str(overtime.data): object &#39;overtime.data&#39; not found</code></pre>
</div>
<div id="transform-data" class="section level2">
<h2>Transform data</h2>
<p>This is usually the most involved step, but for this simple example we just need the datetime and visit columns</p>
<pre class="r"><code>## subset to columns we need
model_data &lt;- overtime.data[,c(&#39;datetime&#39;, &#39;visits&#39;)]</code></pre>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;overtime.data&#39; not found</code></pre>
<pre class="r"><code>## make datetime a Date object
model_data$datetime &lt;- as.Date(model_data$datetime)</code></pre>
<pre><code>## Error in as.Date(model_data$datetime): object &#39;model_data&#39; not found</code></pre>
<p>A quick exploratory plot:</p>
<pre class="r"><code>plot(model_data, type = &quot;l&quot;)</code></pre>
<pre><code>## Error in plot(model_data, type = &quot;l&quot;): object &#39;model_data&#39; not found</code></pre>
</div>
<div id="statistical-modelling" class="section level2">
<h2>Statistical modelling</h2>
<p>We will now use the <a href="https://google.github.io/CausalImpact/">CausalImpact</a> package to test the effect of a pretend TV campaign starting around March 10th</p>
<pre class="r"><code>## install CausalImpact if you don&#39;t already have it
## https://google.github.io/CausalImpact/

## load CausalImpact
library(CausalImpact)
## load zoo for working with timeseries
library(zoo)

## turn model_data into a zoo object to work with CausalImpact
model_zoo &lt;- zoo(model_data$visits, order.by = model_data$datetime)</code></pre>
<pre><code>## Error in MATCH(order.by, order.by): object &#39;model_data&#39; not found</code></pre>
<pre class="r"><code>## specify the before and after event segments
## assuming the TV campaign started on 3rd March, 2016
pre.period &lt;- as.Date(c(&quot;2016-02-25&quot;, &quot;2016-07-10&quot;))
post.period &lt;- as.Date(c(&quot;2016-07-11&quot;,&quot;2016-09-25&quot;))

impact &lt;- CausalImpact(model_zoo, pre.period, post.period) </code></pre>
<pre><code>## Error in xor(!is.null(data) &amp;&amp; !is.null(pre.period) &amp;&amp; !is.null(post.period) &amp;&amp; : object &#39;model_zoo&#39; not found</code></pre>
<p>CausalImpact includes a verbal report and plot to show its findings:</p>
<pre class="r"><code>impact$report</code></pre>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;impact&#39; not found</code></pre>
<pre class="r"><code>plot(impact)</code></pre>
<pre><code>## Error in plot(impact): object &#39;impact&#39; not found</code></pre>
</div>
<div id="review-output" class="section level2">
<h2>Review output</h2>
<p>Many refinements to the model could be made, for instance:</p>
<ul>
<li>Also download control metrics such as direct visits, paid search that may be confounders</li>
<li>Combine the model data with TV spend data</li>
</ul>
<p>…but for now we assume the output is valuable and we want to publish.</p>
</div>
<div id="finalise-output" class="section level2">
<h2>Finalise Output</h2>
<p>For final display we use a D3 javascript library, <a href="https://rstudio.github.io/dygraphs/">Dygraphs</a>, to display the results:</p>
<pre class="r"><code>## install dygraphs if necessary
library(dygraphs)

## plot data kept in impact$series
plot_data &lt;- impact$series</code></pre>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;impact&#39; not found</code></pre>
<pre class="r"><code>dygraph(data=plot_data[,c(&#39;cum.effect&#39;, &#39;cum.effect.lower&#39;, &#39;cum.effect.upper&#39;)],
        main=&quot;Cumulative Impact of Event (95% confidence level)&quot;, group=&quot;ci&quot;) %&gt;%
  dyRangeSelector() %&gt;%
  dyEvent(x = as.Date(&quot;2016-03-10&quot;), &quot;TV Campaign&quot;) %&gt;%
  dySeries(c(&#39;cum.effect.lower&#39;, &#39;cum.effect&#39;, &#39;cum.effect.upper&#39;), label=&#39;Cumulative Effect&#39;)</code></pre>
<pre><code>## Error in dygraph(data = plot_data[, c(&quot;cum.effect&quot;, &quot;cum.effect.lower&quot;, : object &#39;plot_data&#39; not found</code></pre>
</div>
<div id="automate" class="section level2">
<h2>Automate?</h2>
<p>For automation, the script could run every day to update with the most recent web data, and pull TV campaign dates from another maintained file.</p>
<p>The results could also be made available via a JSON API using a service such as [OpenCPU], for display in other departments dashboards or similar.</p>
<p>A final step could be to alter marketing spend based on the results of the function - for instance increasing brand PPC spend for TV campaigns that have a poor effect.</p>
</div>
</div>
<div id="data-strategy-for-larger-data" class="section level1">
<h1>Data strategy for larger data</h1>
<p>It may be that the amount of data you require is more than can reasonably be gathered through the API.</p>
<p>In that instance, other strategies used are, in rough order of performance:</p>
<ol style="list-style-type: decimal">
<li>Export the raw data dump from Adobe Analytics into a database, then use R connectors for that.
<ul>
<li>R is also integrated into Spark, so Hadoop/SparkR integrations are used.</li>
</ul></li>
<li>Export Data Warehouse exports via secure FTP to a folder, then read the csv files into R.</li>
<li>Build robust scripts that retry timeouts from the API and batch and recombine data over a long period.</li>
</ol>
</div>
<div id="generating-web_data" class="section level1">
<h1>Generating web_data</h1>
<p>Throughout this site, examples and exercise use a data frame called <code>web_data</code>. That example data was initially built using Google Analytics data, and instructions for generating that data with your own Google Analytic data are on the <a href="http://www.dartistics.com/api-google-analytics.html">Google Analytics API</a> page.</p>
<p>But, you’re reading about the Adobe Analytics API here, so we can assume you might want to do these same exercises with Adobe Analytics data. To do that, we can use <strong>Last Touch Channel</strong> (Adobe) in lieu of <strong>Default Channel Grouping</strong> (Google Analytics), as well as swap out some other values for comparable dimensions and metrics. If you are not using <strong>Marketing Channels</strong> in Adobe Analytics, then you will need to adjust the code below by replacing the <code>lasttouchchannel</code> dimension with the appropriate dimension.</p>
<p>To do that, first follow the steps for one of the authentication options described earlier on this page. Once that is done, you can use the following overtime command to pull the base data.</p>
<pre><code>## Warning in SCAuth(key, secret): Check User Name. Must have
## &#39;username:company&#39; pattern</code></pre>
<pre><code>## Warning in SCAuth(key, secret): Shared Secret does not have valid number of
## characters (32)</code></pre>
<pre><code>## Error in SCAuth(key, secret): Authentication failed due to errors</code></pre>
<pre class="r"><code># reportsuite.id &lt;- [uncomment this line and insert your RSID]
date.from &lt;- &quot;2016-01-01&quot;
date.to &lt;- &quot;2016-08-01&quot;
metrics &lt;- c(&quot;visits&quot;,&quot;pageviews&quot;,&quot;entries&quot;,&quot;bounces&quot;)
elements &lt;- c(&quot;mobiledevicetype&quot;,&quot;lasttouchchannel&quot;)
top &lt;- 10
date.granularity &lt;- &quot;day&quot;

web_data &lt;- QueueTrended(reportsuite.id, 
                         date.from, date.to,
                         metrics,
                         elements,
                         top = top)</code></pre>
<pre><code>## Error: $ operator is invalid for atomic vectors</code></pre>
<p>This should give us a table that looks something like this:</p>
<table>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="left">channelGrouping</th>
<th align="left">deviceCategory</th>
<th align="right">sessions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">desktop</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">mobile</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">tablet</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Direct</td>
<td align="left">desktop</td>
<td align="right">133</td>
</tr>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">Direct</td>
<td align="left">mobile</td>
<td align="right">345</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Direct</td>
<td align="left">tablet</td>
<td align="right">126</td>
</tr>
</tbody>
</table>
<p>We need to do a little bit of adjustments to the data to, well, Google-ify it – make it structurally match what’s expected for the other examples on this site.</p>
<p>First, let’s drop the <code>segment.id</code> and <code>segment.name</code> columns and rename the columns:</p>
<pre class="r"><code>library(dplyr)  # We&#39;ll use the select() function from dplyr

web_data &lt;- select(web_data,-segment.id,-segment.name)</code></pre>
<pre><code>## Error in -segment.id: invalid argument to unary operator</code></pre>
<pre class="r"><code>colnames(web_data) &lt;- c(&quot;date&quot;,&quot;deviceCategory&quot;,&quot;channelGrouping&quot;,&quot;sessions&quot;,
                        &quot;pageviews&quot;,&quot;entrances&quot;,&quot;bounces&quot;)</code></pre>
<pre><code>## Error in names(x) &lt;- value: &#39;names&#39; attribute [7] must be the same length as the vector [4]</code></pre>
<p>And, now, we need to do a few additional things <em>just</em> to make the data match the sort of data that comes out of a similar query to Google Analytics, which will make the object more compatible with other examples on this site.</p>
<pre class="r"><code># Change the `date` format to be `Date` rather than `POSIXlt.`
web_data$date &lt;- as.Date(web_data$date)

# Change the `Other` value to be `Desktop` for `deviceCategory.`
web_data[web_data$deviceCategory==&quot;Other&quot;,&quot;deviceCategory&quot;] &lt;- &quot;Desktop&quot;

#Change `Natural Search` to `Organic Search` for `channelGrouping.`
web_data[web_data$channelGrouping==&quot;Natural Search&quot;,&quot;channelGrouping&quot;] &lt;- &quot;Organic Search&quot;</code></pre>
<p>This should give us a table that looks something like this:</p>
<table>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="left">channelGrouping</th>
<th align="left">deviceCategory</th>
<th align="right">sessions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">desktop</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">mobile</td>
<td align="right">112</td>
</tr>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">tablet</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Direct</td>
<td align="left">desktop</td>
<td align="right">133</td>
</tr>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">Direct</td>
<td align="left">mobile</td>
<td align="right">345</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">Direct</td>
<td align="left">tablet</td>
<td align="right">126</td>
</tr>
</tbody>
</table>
<p>And, this <em>should</em> be a data frame that can now be used in other examples on this site.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
