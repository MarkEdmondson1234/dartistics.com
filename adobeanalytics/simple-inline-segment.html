<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Simple Inline Segment</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="includes/styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Adobe Analytics & R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
<li>
  <a href="setup.html">Initial Setup</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Basic Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="simple-trended-visits-by-devicetype.html">Trended Visits by Device Type</a>
    </li>
    <li>
      <a href="simple-trended-visits-by-devicetype.html">Scatterplot: Pageviews vs. Visits</a>
    </li>
    <li>
      <a href="simple-dim-filter.html">Simple Dimension Filter</a>
    </li>
    <li>
      <a href="segment-by-id.html">Apply Segment by Segment ID</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Intermediate Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pivot-sparklines-heatmap.html">2D Sparklines/Heatmap</a>
    </li>
    <li>
      <a href="simple-inline-segment.html">Simple Inline Segment</a>
    </li>
    <li>
      <a href="int-heatmap.html">Day/Hour Heatmap</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://dartistics.com">dartistics.com</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-N4DF7T"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N4DF7T');</script>
<!-- End Google Tag Manager -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Simple Inline Segment</h1>

</div>


<p>“Simple” may be a bit of a misnomer here. This is a “simple-in-what-we’re-trying-to-do” example if not a “simple-to-actually-implement” one.</p>
<p><strong>Note</strong>: <em>This example uses the <code>unbox()</code> function from the <code>jsonlite</code> package. If you do not already have <code>jsonlite</code> installed (or if you’re not sure), run <code>install.packages(&quot;jsonlite&quot;)</code> in the console before running this example.</em></p>
<p>This example pulls the top 10 pages for the last thirty days, <em>for visits where the entry page included the word “Intelligence”</em>. We’ll do this by building a segment <em>dynamically</em> rather than referencing a segment ID. Where this can come in handy is if you have a script where you want to work through a range of small little tweaks to one segment and re-pull the data. You don’t want to build each segment in the web interface and then hardcode all those IDs! We may add an example for doing that later, but we’re doing to keep this very simple for now.</p>
<p>This returns the exact same results as these <a href="segment-by-id.html">Apply Segment by Segment ID</a> example. It just doesn’t require any work in the Adobe Analytics web interface to return the results.</p>
<div id="setupconfig" class="section level1">
<h1>Setup/Config</h1>
<p>Be sure you’ve completed the steps on the <a href="setup.html">Initial Setup</a> page before running this code.</p>
<p>For the setup, we’re going to load a few libraries, load our specific Adobe Analytics credentials, and then authorize with Adobe.</p>
<pre class="r"><code># Load the necessary libraries. The &#39;typical&#39; way to do this is with a series of
# &#39;library([library name])&#39; calls. The use of the pacman package, though, adds a
# check that will install any missing packages before then loading them.
if (!require(&quot;pacman&quot;)) install.packages(&quot;pacman&quot;)
pacman::p_load(RSiteCatalyst,
               tidyverse, 
               jsonlite)    # Needed for unbox() in examples with inline segments

# Load the username, shared secret, and report suite ID
username &lt;- Sys.getenv(&quot;ADOBE_API_USERNAME&quot;)
secret &lt;- Sys.getenv(&quot;ADOBE_API_SECRET&quot;)

# Authorize Adobe Aalytics.
SCAuth(username, secret)

# Set the RSID and the date range. If you want to, you can swap out the Sys.getenv()
# call and just replace that with a hardcoded value for the RSID. And, the start 
# and end date are currently set to choose the last 30 days, but those can be 
# hardcoded as well.
rsid &lt;- Sys.getenv(&quot;ADOBE_RSID&quot;)
start_date &lt;- Sys.Date() - 31        # 30 days back from yesterday
end_date &lt;- Sys.Date() - 1           # Yesterday</code></pre>
<p>If that all runs with just some messages but no errors, then you’re set for the next chunk of code: pulling the data.</p>
</div>
<div id="pull-the-data" class="section level1">
<h1>Pull the Data</h1>
<p>This gets built up in what can feel a bit cumbersome. <em>Essentially</em> (but not necessarily <em>intuitively</em>), Adobe Analytics segments can have containers within containers. R has an analog: lists. A list can have a list as an element. So, we use lists to define inline segments.</p>
<pre class="r"><code># Create the actual segment object that we&#39;re going to use in the query. See ?segment_ga4()
# for details.
my_segment &lt;- list(container = list(type = unbox(&quot;visits&quot;),
                                    rules = data.frame(name = &quot;Entry Page Includes &#39;excel&#39;&quot;,
                                                       element = &quot;entrypage&quot;,
                                                       operator = &quot;contains&quot;,
                                                       value = &quot;Intelligence&quot;)))

# Pull the data. See ?QueueRankes() for details on the arguments available. Note that
# we&#39;re using segment.inline as an argument here.
aa_data &lt;- QueueRanked(rsid,
                       date.from = start_date,
                       date.to = end_date,
                       metrics = &quot;pageviews&quot;,
                       elements = &quot;page&quot;,
                       top = 10,
                       segment.inline = my_segment)
  
# Go ahead and do a quick inspection of the data that was returned. This isn&#39;t required,
# but it&#39;s a good check along the way.
head(aa_data)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">url</th>
<th align="right">pageviews</th>
<th align="left">segment.id</th>
<th align="left">segment.name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Search Discovery, Inc. - A Digital Intelligence Company</td>
<td align="left"><a href="https://www.searchdiscovery.com" class="uri">https://www.searchdiscovery.com</a></td>
<td align="right">1589</td>
<td align="left">segment1</td>
<td align="left">inline segment</td>
</tr>
<tr class="even">
<td align="left">Search Discovery, Inc. - A Business Intelligence and Analytics Company</td>
<td align="left"><a href="http://searchdiscover.staging.wpengine.com" class="uri">http://searchdiscover.staging.wpengine.com</a></td>
<td align="right">581</td>
<td align="left">segment1</td>
<td align="left">inline segment</td>
</tr>
<tr class="odd">
<td align="left">Open Positions - Search Discovery</td>
<td align="left"><a href="https://www.searchdiscovery.com/open-positions" class="uri">https://www.searchdiscovery.com/open-positions</a></td>
<td align="right">527</td>
<td align="left">segment1</td>
<td align="left">inline segment</td>
</tr>
<tr class="even">
<td align="left">Digital Marketing, Analytics and Business Intelligence Jobs at Search Discovery</td>
<td align="left"><a href="https://www.searchdiscovery.com/about/careers" class="uri">https://www.searchdiscovery.com/about/careers</a></td>
<td align="right">495</td>
<td align="left">segment1</td>
<td align="left">inline segment</td>
</tr>
<tr class="odd">
<td align="left">About Our Digital Intelligence Company | Search Discovery</td>
<td align="left"><a href="https://www.searchdiscovery.com/about" class="uri">https://www.searchdiscovery.com/about</a></td>
<td align="right">430</td>
<td align="left">segment1</td>
<td align="left">inline segment</td>
</tr>
<tr class="even">
<td align="left">Digital Intelligence Solutions | Search Discovery</td>
<td align="left"><a href="https://www.searchdiscovery.com/solutions" class="uri">https://www.searchdiscovery.com/solutions</a></td>
<td align="right">323</td>
<td align="left">segment1</td>
<td align="left">inline segment</td>
</tr>
</tbody>
</table>
</div>
<div id="data-munging" class="section level1">
<h1>Data Munging</h1>
<p>In order to keep the order in the bar chart, we need to convert the page column to be a factor. We’ll reverse the order so that, when displayed in a bar chart, they’ll be in descending order.</p>
<pre class="r"><code># Convert page to be a factor
aa_data$name &lt;- factor(aa_data$name,
                       levels = rev(aa_data$name))</code></pre>
</div>
<div id="data-visualization" class="section level1">
<h1>Data Visualization</h1>
<p>This won’t be the prettiest bar chart, but let’s make a horizontal bar chart with the data. Remember, in <strong>ggplot2</strong>, a horizontal bar chart is just a normal bar chart with <code>coord_flip()</code>.</p>
<pre class="r"><code># Create the plot. Note the stat=&quot;identity&quot;&quot; (because the data is already aggregated) and
# the coord_flip(). And, I just can&#39;t stand it... added on the additional theme stuff to
# clean up the plot a bit more.
gg &lt;- ggplot(aa_data, mapping = aes(x = name, y = pageviews)) +
  geom_bar(stat = &quot;identity&quot;) +
  coord_flip() +
  theme_light() +
  theme(panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.border = element_blank(),
        axis.title.y = element_blank(),
        axis.ticks.y = element_blank())

# Output the plot. You *could* just remove the &quot;gg &lt;-&quot; in the code above, but it&#39;s
# generally a best practice to create a plot object and then output it, rather than
# outputting it on the fly.
print(gg)</code></pre>
<p><img src="simple-inline-segment_files/figure-html/visualize-1.png" width="960" /></p>
</div>

<hr>
<p align="center"><em></em>This site is a sub-site to <a href="http://dartistics.com" target="_blank">dartistics.com</em></p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
