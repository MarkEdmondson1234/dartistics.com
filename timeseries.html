<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Time Series</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DARTISTICS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="example1.html">Example: Trending</a>
    </li>
    <li>
      <a href="example2.html">Example: Data Explorer</a>
    </li>
    <li>
      <a href="example3.html">Example: Venn Diagram</a>
    </li>
    <li>
      <a href="example4.html">Example: GA Effect</a>
    </li>
    <li>
      <a href="example5.html">Example: Heatmap</a>
    </li>
    <li>
      <a href="example6.html">Example: Forecasting</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Programming
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">THE BASICS</li>
    <li>
      <a href="whatisr.html">What Is R?</a>
    </li>
    <li>
      <a href="gettingstarted.html">Getting Started</a>
    </li>
    <li>
      <a href="packages.html">Packages</a>
    </li>
    <li>
      <a href="basics-base_r.html">Basics of Base R</a>
    </li>
    <li>
      <a href="exercise1-thebasics.html">Exercise: The Basic Basics</a>
    </li>
    <li class="dropdown-header">ADVANCED TOPICS</li>
    <li>
      <a href="troubleshooting.html">Troubleshooting</a>
    </li>
    <li>
      <a href="fast-r-code.html">Faster R code</a>
    </li>
    <li>
      <a href="functions.html">Using R functions</a>
    </li>
    <li>
      <a href="creating-packages.html">Creating R packages</a>
    </li>
    <li>
      <a href="cloud-computing.html">Cloud computing &amp; R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    I/O
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">WORKING WITH FILES</li>
    <li>
      <a href="import-csv-excel.html">CSV import</a>
    </li>
    <li>
      <a href="excel.html">Microsoft Excel(!)</a>
    </li>
    <li>
      <a href="exercise2-io.html">Exercise: I/O</a>
    </li>
    <li class="dropdown-header">WORKING WITH APIs</li>
    <li>
      <a href="api-google-analytics.html">Google Analytics</a>
    </li>
    <li>
      <a href="api-adobe-analytics.html">Adobe Analytics</a>
    </li>
    <li>
      <a href="api-other.html">Other APIs</a>
    </li>
    <li>
      <a href="renviron.html">.Renviron</a>
    </li>
    <li>
      <a href="creating-apis.html">Creating API libraries</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Structures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R CLASSES AND SYNTAX</li>
    <li>
      <a href="classes.html">R Classes</a>
    </li>
    <li>
      <a href="accessing.html">Accessing elements</a>
    </li>
    <li>
      <a href="learn-to-love-lists.html">Learning to love lists</a>
    </li>
    <li>
      <a href="exercise3-accessing-data.html">Exercise: Accessing Data</a>
    </li>
    <li class="dropdown-header">BASE R vs. TIDY</li>
    <li>
      <a href="tidyverse.html">Tidy data / Tidyverse</a>
    </li>
    <li>
      <a href="dplyr.html">dplyr()</a>
    </li>
    <li>
      <a href="exercise4-tidy-dplyr.html">Exercise: Tidy Data / dplyr</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Statistics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="modelling-intro.html">Introduction</a>
    </li>
    <li>
      <a href="nature-of-data.html">Nature of Data</a>
    </li>
    <li>
      <a href="cross-tab-w-chi-square.html">Chi Square</a>
    </li>
    <li>
      <a href="anova.html">ANOVA</a>
    </li>
    <li>
      <a href="correlation.html">Correlation</a>
    </li>
    <li>
      <a href="regression.html">Regression</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series</a>
    </li>
    <li>
      <a href="categorisation.html">Categorisation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Output
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="viz-options.html">Visualisation Options</a>
    </li>
    <li>
      <a href="base-plots.html">Base Plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2()</a>
    </li>
    <li>
      <a href="htmlwidgets.html">htmlwidgets()</a>
    </li>
    <li>
      <a href="rmarkdown-shiny.html">RMarkdown or Shiny?</a>
    </li>
    <li>
      <a href="basic-rmarkdown.html">Basic RMarkdown</a>
    </li>
    <li>
      <a href="advanced-rmarkdown.html">Advanced RMarkdown</a>
    </li>
    <li>
      <a href="shiny.html">Shiny</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="resources.html">Useful Links</a>
    </li>
    <li>
      <a href="key-topics.html">Key topics</a>
    </li>
    <li>
      <a href="googleanalytics/index.html">Google Analytics Examples</a>
    </li>
    <li>
      <a href="adobeanalytics/index.html">Adobe Analytics Examples</a>
    </li>
    <li>
      <a href="github.html">GitHub</a>
    </li>
    <li>
      <a href="habits.html">Good Habits</a>
    </li>
    <li>
      <a href="going-further.html">Going Further</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-N4DF7T"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N4DF7T');</script>
<!-- End Google Tag Manager -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Time Series</h1>

</div>


<p>Time-series are a special sub-class of data, referring to when you have some ordered observations over time.</p>
<p>Time-series are often found when dealing with digital analytics, and R uses a special class to deal with them as they have some unique properties. A guide to general R timeseries is <a href="http://www.statmethods.net/advstats/timeseries.html">here</a> and a list of possible packages to use with time-series is in this <a href="https://cran.r-project.org/web/views/TimeSeries.html">CRAN task view</a>. If you want to get into forecasting then another R New-Zealand hero is Rob Hyndman, who has lots of techniques described on his <a href="http://robjhyndman.com/hyndsight/">blog</a>.</p>
<p>Time-series are created in base R via the <code>ts()</code> command, which you will typically feed in some numeric data that is assumed to be in order of observation.</p>
<p>For most purposes you will be starting from a <code>data.frame</code> and need to transform it into a <code>time-series</code> in order for the R functions to work.</p>
<div id="creating-time-series" class="section level2">
<h2>Creating time-series</h2>
<div style="background-color: #cce6ff; font-style: italic; padding: 10px 10px 10px 10px;">
<p>This exercise requires having a <code>web_data</code> data frame. You can either load up some sample data by completing the <a href="exercise2-io.html">I/O Exercise</a> (which is what is shown in the step-by-step instructions below), or, if you have access to a Google Analytics account, you can use your own data by following the steps on the <a href="api-google-analytics.html">Google Analytics API page</a>. <em>Or</em>, if you have access to an Adobe Analytics account, then you can use your own data by following the <strong>Generating web_data</strong> steps on the <a href="api-adobe-analytics.html#generating_web_data">Adobe Analytics API page</a>.</p>
Once you have a <code>web_data</code> data frame to work with, the command <code>head(web_data)</code> should return a table that, at least structurally, looks something like this:
</div>
<table>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="left">channelGrouping</th>
<th align="left">deviceCategory</th>
<th align="right">sessions</th>
<th align="right">pageviews</th>
<th align="right">entrances</th>
<th align="right">bounces</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">desktop</td>
<td align="right">19</td>
<td align="right">23</td>
<td align="right">19</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">mobile</td>
<td align="right">112</td>
<td align="right">162</td>
<td align="right">112</td>
<td align="right">82</td>
</tr>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="left">(Other)</td>
<td align="left">tablet</td>
<td align="right">24</td>
<td align="right">41</td>
<td align="right">24</td>
<td align="right">19</td>
</tr>
</tbody>
</table>
<p>We will start by pivoting the data like before:</p>
<pre class="r"><code>## use tidyverse to pivot the data
library(dplyr)
library(tidyr)

## get only desktop rows, and the date, channelGrouping and sessions columns
pivoted &lt;- web_data %&gt;% 
  filter(deviceCategory == &quot;desktop&quot;) %&gt;% 
  select(date, channelGrouping, sessions) %&gt;%
  spread(channelGrouping, sessions)

## get rid of any NA&#39;s and replace with 0
pivoted[is.na(pivoted)] &lt;- 0</code></pre>
<pre class="r"><code>head(pivoted)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="right">(Other)</th>
<th align="right">Direct</th>
<th align="right">Display</th>
<th align="right">Email</th>
<th align="right">Organic Search</th>
<th align="right">Paid Search</th>
<th align="right">Referral</th>
<th align="right">Social</th>
<th align="right">Video</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-01-01</td>
<td align="right">19</td>
<td align="right">133</td>
<td align="right">307</td>
<td align="right">17</td>
<td align="right">431</td>
<td align="right">555</td>
<td align="right">131</td>
<td align="right">68</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2016-01-02</td>
<td align="right">156</td>
<td align="right">1003</td>
<td align="right">196</td>
<td align="right">43</td>
<td align="right">1077</td>
<td align="right">1060</td>
<td align="right">226</td>
<td align="right">158</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">2016-01-03</td>
<td align="right">35</td>
<td align="right">1470</td>
<td align="right">235</td>
<td align="right">29</td>
<td align="right">696</td>
<td align="right">489</td>
<td align="right">179</td>
<td align="right">66</td>
<td align="right">90</td>
</tr>
<tr class="even">
<td align="left">2016-01-04</td>
<td align="right">31</td>
<td align="right">1794</td>
<td align="right">321</td>
<td align="right">70</td>
<td align="right">1075</td>
<td align="right">558</td>
<td align="right">235</td>
<td align="right">46</td>
<td align="right">898</td>
</tr>
<tr class="odd">
<td align="left">2016-01-05</td>
<td align="right">27</td>
<td align="right">1899</td>
<td align="right">309</td>
<td align="right">74</td>
<td align="right">1004</td>
<td align="right">478</td>
<td align="right">218</td>
<td align="right">47</td>
<td align="right">461</td>
</tr>
<tr class="even">
<td align="left">2016-01-06</td>
<td align="right">21</td>
<td align="right">1972</td>
<td align="right">204</td>
<td align="right">299</td>
<td align="right">974</td>
<td align="right">494</td>
<td align="right">246</td>
<td align="right">47</td>
<td align="right">418</td>
</tr>
</tbody>
</table>
</div>
<div id="a-seasonal-time-series" class="section level2">
<h2>A seasonal time-series</h2>
<p>For data lengths less than a year, then a weekly seasonality is most likely. Adding this seasonality to your data can be very helpful in creating forecasts as it helps extract a real trend.</p>
<pre class="r"><code>## make a time-series object
web_data_ts &lt;- ts(pivoted[-1], frequency = 7)

## time-series are set up to have useful plots
plot(web_data_ts, axes = FALSE)</code></pre>
<p><img src="timeseries_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="time-series-appplications" class="section level2">
<h2>Time-series appplications</h2>
<div id="decomposition" class="section level3">
<h3>Decomposition</h3>
<p>With seasonal data, you can extract the seasonality (weekly in this example) so you can more easily see the overall trend of data:</p>
<pre class="r"><code>decomp &lt;- decompose(web_data_ts[, &quot;Organic Search&quot;])
plot(decomp)</code></pre>
<p><img src="timeseries_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<ul>
<li><em>Observed</em> - the original data</li>
<li><em>Trend</em> - the data minus the seasonal</li>
<li><em>Seasonal</em> - data that fits the specified seasonality (7 days)</li>
<li><em>Random</em> - everything else left only - useful for anomoloy detection.</li>
</ul>
</div>
<div id="forecasts" class="section level3">
<h3>Forecasts</h3>
<p>Forecasting looks at the trend of the data and makes judgements on where the trend will go. A good blog from Hyndman on <a href="http://robjhyndman.com/hyndsight/dailydata/">daily data forecasting</a> is here.</p>
<p>A couple of example functions:</p>
<pre class="r"><code>library(forecast)
## performs decomposition and smoothing
fit &lt;- ets(web_data_ts[, &quot;Organic Search&quot;])
## makes the forecast
fc &lt;- forecast(fit)
plot(fc)</code></pre>
<p><img src="timeseries_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p><code>HoltWinters()</code> is a function in base R that also lets you take account of seasonal effects:</p>
<pre class="r"><code>fit2 &lt;- HoltWinters(web_data_ts[, &quot;Organic Search&quot;])
## makes the forecast
fc2 &lt;- forecast(fit2, h = 25)
plot(fc2)</code></pre>
<p><img src="timeseries_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
</div>
<div id="converting-to-xts-for-some-packages" class="section level2">
<h2>Converting to xts for some packages</h2>
<p>We can only work with numeric data, but we would also like to keep the date information, mainly for labelling purposes. <code>xts</code> lets you create the time-series whilst specifying the date labels like so:</p>
<pre class="r"><code>library(xts)

## create a time-series zoo object
web_data_xts &lt;- xts(pivoted[-1], order.by = as.Date(pivoted$date), frequency = 7)</code></pre>
<p><code>web_data_xts</code> will look similar to when it was a data.frame, but its now in the right class to do some nice related functions.</p>
</div>
<div id="causalimpact" class="section level2">
<h2>CausalImpact</h2>
<p>A good example of a library that needs <code>xts</code> is <a href="https://google.github.io/CausalImpact/">CausalImpact</a>, which is a fantastic library from Google well suited for digital marketing.</p>
<p>CausalImpact gives you an estimate on how much effect an event at a certain point of time had on your metrics, in absolute and relative terms. In this case, an event could be a TV campaign starting or changing your Title tags. It also lets you add control segments, so you can adjust for known effects.</p>
<p>As an example, we assume the observed peak in Social traffic is due to the start of some campaign in May 15th 2016 (in reality you should not cherry pick dates like this!) and we woud like to observe its effect on Video sessions. We also add Direct sessions as a control to help account for general website trends.</p>
<pre class="r"><code>library(CausalImpact)
pre.period &lt;- as.Date(c(&quot;2016-02-01&quot;,&quot;2016-05-14&quot;))
post.period &lt;- as.Date(c(&quot;2016-05-15&quot;,&quot;2016-07-15&quot;))

## data in order of response, predictor1, predictor2, etc.
model_data &lt;- web_data_xts[,c(&quot;Video&quot;,&quot;Social&quot;,&quot;Direct&quot;)]


impact &lt;- CausalImpact(model_data,  pre.period, post.period)
plot(impact)</code></pre>
<p><img src="timeseries_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<ul>
<li><em>original</em> - the original response data, with a forecast (blue) of where it should have been in post event period</li>
<li><em>pointwise</em> - the difference between the forecast and reality per day</li>
<li><em>cumulative</em> - the cumuative effect on sessions in the post event period</li>
</ul>
<p>CausalImpact is the work-horse behind the <a href="https://gallery.shinyapps.io/ga-effect/">GA Effect app</a>.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
