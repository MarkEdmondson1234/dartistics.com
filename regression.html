<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Regression</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DARTISTICS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Overview
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="example1.html">Example: Trending</a>
    </li>
    <li>
      <a href="example2.html">Example: Data Explorer</a>
    </li>
    <li>
      <a href="example3.html">Example: Venn Diagram</a>
    </li>
    <li>
      <a href="example4.html">Example: GA Effect</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    The Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="whatisr.html">What Is R?</a>
    </li>
    <li>
      <a href="rstudio.html">RStudio</a>
    </li>
    <li>
      <a href="packages.html">Packages</a>
    </li>
    <li>
      <a href="basics-base_r.html">Basics of Base R</a>
    </li>
    <li>
      <a href="exercise1-thebasics.html">Exercise: The Basic Basics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    I/O
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">WORKING WITH FILES</li>
    <li>
      <a href="import-csv-excel.html">CSV import</a>
    </li>
    <li>
      <a href="excel.html">Microsoft Excel(!)</a>
    </li>
    <li>
      <a href="exercise2-io.html">Exercise: I/O</a>
    </li>
    <li class="dropdown-header">WORKING WITH APIs</li>
    <li>
      <a href="api-google-analytics.html">Google Analytics</a>
    </li>
    <li>
      <a href="api-adobe-analytics.html">Adobe Analytics</a>
    </li>
    <li>
      <a href="api-other.html">Other APIs</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Structures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R CLASSES AND SYNTAX</li>
    <li>
      <a href="classes.html">R Classes</a>
    </li>
    <li>
      <a href="accessing.html">Accessing elements</a>
    </li>
    <li>
      <a href="exercise3-accessing-data.html">Exercise: Accessing Data</a>
    </li>
    <li class="dropdown-header">BASE R vs. TIDY</li>
    <li>
      <a href="tidyverse.html">Tidy data / Tidyverse</a>
    </li>
    <li>
      <a href="dplyr.html">dplyr()</a>
    </li>
    <li>
      <a href="exercise4-tidy-dplyr.html">Exercise: Tidy Data / dplyr</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="modelling-intro.html">Introduction</a>
    </li>
    <li>
      <a href="correlation.html">Correlation</a>
    </li>
    <li>
      <a href="regression.html">Regression</a>
    </li>
    <li>
      <a href="timeseries.html">Time-series</a>
    </li>
    <li>
      <a href="categorisation.html">Categorisation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Output
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="viz-options.html">Visualisation Options</a>
    </li>
    <li>
      <a href="base-plots.html">Base Plots</a>
    </li>
    <li>
      <a href="ggplot2.html">ggplot2()</a>
    </li>
    <li>
      <a href="htmlwidgets.html">htmlwidgets()</a>
    </li>
    <li>
      <a href="rmarkdown-shiny.html">RMarkdown + Shiny</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="resources.html">Useful Links</a>
    </li>
    <li>
      <a href="key-topics.html">Key topics</a>
    </li>
    <li>
      <a href="github.html">GitHub</a>
    </li>
    <li>
      <a href="habits.html">Good Habits</a>
    </li>
    <li>
      <a href="going-further.html">Going Further</a>
    </li>
    <li>
      <a href="r-and-statistics-class.html">3-Day Training</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-N4DF7T"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N4DF7T');</script>
<!-- End Google Tag Manager -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Regression</h1>

</div>


<p>Regression is a way to represent cause and effect between two (or more variables). It attempts to make a best guess or model on how variables influence each other, and gives you an equation which you can use to predict future values.</p>
<p>If you want to just measure how closely two variables are and in which direction, correlation is more appropriate. However, if you want to try and make predictions from another metric then regression may be the tool for you.</p>
<div id="types-of-regression" class="section level1">
<h1>Types of regression</h1>
<p>There are many types of regression for different data scenarios, but we will cover just a few in this introduction that you may need for your own data.</p>
<div id="simple-linear-regression" class="section level2">
<h2>Simple linear regression</h2>
<p>Simple linear regression is performed between two variables, of the form:</p>
<pre><code>y = Ax + e</code></pre>
<p>Where <code>y</code> is the metric you want to predict (<em>dependent variable</em>), <code>x</code> a vector of metrics you want to use to predict <code>y</code> (<em>regressors/predictors</em>), <code>A</code> is the matrix of <em>regression coefficients</em> of for the variables in <code>x</code> and <code>e</code> being the bit not predicted, sometimes called <em>noise</em>.</p>
<p>In two dimensions this is the same as</p>
<pre><code>y = mx + c + e</code></pre>
<p>Which you may recognise as the equation for a straight line on a x-y plot, where m is the slope, c is the intercept, and e the random noise.</p>
<p>In three or more dimensions this expands to</p>
<pre><code>y = a_0 + a_1 * x_1 + a_2 * x_2 + ... + a_n * x_n</code></pre>
<p>Where <code>a_0</code> is the intercept, <code>a_1</code>, <code>a_2</code>, etc. are the regression coefficients and <code>x_1</code>, <code>x_2</code> etc. are the regressions/predictors.</p>
<p>That is pretty much what ordinary linear regression is, where the technique of least-squares is used to fit a line/plane to some points.</p>
<blockquote>
<p>An example applied to digital marketing would be predicting transactions from sessions. The regression coefficient in this case would represent a derived conversion rate.</p>
</blockquote>
<div id="example-with-search-console-impressions" class="section level3">
<h3>Example with Search Console Impressions</h3>
<p>If you already have a conversion rate, there isn’t much to gain from creating another via linear regression, but in many cases you don’t have that linked up view which is where regression can come into play. An example below looks for a relationship to a website’s SEO impressions in Google to the amount of transactions that day. This example is in two dimensions which makes it much easier to plot charts showing what is going on.</p>
<p>For this example we shall use the dataset <code>search_console_plus_ga.csv</code>, which is two datasets joined on date - SEO impressions and other metrics from Search Console via the <code>searchConsoleR</code> package, and Google Analytics total sessions and transactions from <code>googleAnalyticsR</code></p>
<pre class="r"><code>library(knitr) # nice tables
sc_ga_data &lt;- read.csv(&quot;./data/search_console_plus_ga.csv&quot;, stringsAsFactors = FALSE)

kable(head(sc_ga_data))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">date</th>
<th align="right">sessions</th>
<th align="right">transactions</th>
<th align="right">clicks</th>
<th align="right">impressions</th>
<th align="right">ctr</th>
<th align="right">position</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2016-06-03</td>
<td align="right">682</td>
<td align="right">78</td>
<td align="right">288</td>
<td align="right">35512</td>
<td align="right">0.0081099</td>
<td align="right">14.33242</td>
</tr>
<tr class="even">
<td align="left">2016-06-04</td>
<td align="right">533</td>
<td align="right">76</td>
<td align="right">228</td>
<td align="right">25727</td>
<td align="right">0.0088623</td>
<td align="right">16.78062</td>
</tr>
<tr class="odd">
<td align="left">2016-06-05</td>
<td align="right">568</td>
<td align="right">92</td>
<td align="right">248</td>
<td align="right">18341</td>
<td align="right">0.0135216</td>
<td align="right">19.07748</td>
</tr>
<tr class="even">
<td align="left">2016-06-06</td>
<td align="right">879</td>
<td align="right">93</td>
<td align="right">399</td>
<td align="right">23385</td>
<td align="right">0.0170622</td>
<td align="right">17.21142</td>
</tr>
<tr class="odd">
<td align="left">2016-06-07</td>
<td align="right">1085</td>
<td align="right">86</td>
<td align="right">366</td>
<td align="right">22874</td>
<td align="right">0.0160007</td>
<td align="right">20.51867</td>
</tr>
<tr class="even">
<td align="left">2016-06-08</td>
<td align="right">1005</td>
<td align="right">99</td>
<td align="right">351</td>
<td align="right">20237</td>
<td align="right">0.0173445</td>
<td align="right">17.24243</td>
</tr>
</tbody>
</table>
<p>In R, you create linear regression via the <code>lm()</code> function. We will do so looking for the relationship between <code>transactions</code> and <code>impressions</code>.</p>
<pre class="r"><code>model &lt;- lm(transactions ~ impressions, data = sc_ga_data)</code></pre>
<p>The model summary takes a bit of getting used to to interpret, but the interesting bits for us are the <code>r-squared</code> value and the coefficents</p>
<pre class="r"><code>library(broom) ## nice tidy model results

## overall model statistics
glance(model)</code></pre>
<pre><code>##    r.squared adj.r.squared    sigma statistic    p.value df    logLik
## 1 0.04580986    0.03496679 18.41266  4.224805 0.04280121  2 -388.8667
##        AIC      BIC deviance df.residual
## 1 783.7333 791.2328  29834.3          88</code></pre>
<pre class="r"><code>## coefficients
tidy(model)</code></pre>
<pre><code>##          term     estimate    std.error statistic      p.value
## 1 (Intercept) 6.333054e+01 5.7041878936 11.102463 2.027362e-18
## 2 impressions 3.905562e-04 0.0001900116  2.055433 4.280121e-02</code></pre>
<p>The <code>R-squared</code> value is low which specifies the amount of variation explained by the model is low - only 5% of transactions can be attributed to impressions alone. This doesn’t necessarily mean the model is invalid, but does mean predictions will be less accurate.</p>
<p>We can say transactions are related to impressions in a measureable way; that <code>0.00039</code> transactions correspond to each impression, or <code>2564</code> impressions for each transaction.</p>
<p>We plot the data points and the regression line below:</p>
<pre class="r"><code>## put the linear regression line (not accouting for errors)
plot(sc_ga_data$impressions, sc_ga_data$transactions)
abline(reg = coef(model))</code></pre>
<p><img src="regression_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
</div>
<div id="multi-linear-regression" class="section level2">
<h2>Multi-linear regression</h2>
<p>Multi-linear regression is the same as simple linear regression, but you have more predictors - the below shows three (<code>x, y, ø</code>) with corresponding <em>regression coefficients</em> (<code>A, B and C</code>)</p>
<pre><code>y = Ax + Bz + Cø + e</code></pre>
<p>Plotting a multi-linear regression is harder for more than 3 variables, as you need a multi-dimensional space, but its exactly the same principle - in this case the <em>coefficients</em> <code>A, B and C</code> show how much <code>y</code> would change if their respective <em>regressor</em> changed by 1 (and everything else stayed the same)</p>
<p>In R, you create multi-linear regression via the <code>lm()</code> function again, but you just add more variables to the model formula:</p>
<pre class="r"><code>model2 &lt;- lm(transactions ~ impressions + sessions + position, data = sc_ga_data)
## overall model statistics
glance(model2)</code></pre>
<pre><code>##   r.squared adj.r.squared    sigma statistic     p.value df    logLik
## 1 0.1642764     0.1351233 17.43101  5.634947 0.001421253  4 -382.9012
##        AIC      BIC deviance df.residual
## 1 775.8025 788.3015 26130.25          86</code></pre>
<pre class="r"><code>## coefficients
tidy(model2)</code></pre>
<pre><code>##          term      estimate    std.error  statistic    p.value
## 1 (Intercept) 69.8256229916 2.997209e+01  2.3296885 0.02216593
## 2 impressions -0.0001550714 2.905029e-04 -0.5338034 0.59485465
## 3    sessions  0.0394295484 1.331140e-02  2.9620894 0.00395002
## 4    position -1.3288129470 1.161496e+00 -1.1440533 0.25577588</code></pre>
<p>The <code>r-squared</code> value has improved a little so we can explain 16% of transactions from our model.</p>
<blockquote>
<p>How do you think the coefficients of multiple linear regression applied to all Google Analytics sessions compare to the actual conversion rate registered in the E-commerce reports? What about the multi-touch reports?</p>
</blockquote>
</div>
<div id="logistic-regression" class="section level2">
<h2>Logistic regression</h2>
<p>The above regressions are all for continuous data - metrics that can take any value. They don’t work when the thing you want to predict is more categorical e.g. TRUE or FALSE. An example of this could be predicting if a customer is going to transact in a web session or not.</p>
<p>In R, you create logistic regression by using the <code>glm()</code> function and passing in a family argument. In this case we choose <code>binomial</code> (another name for logistic), but the argument takes many other names too for different types of regression - see <code>?family</code> for details.</p>
<pre class="r"><code>model &lt;- glm(sale ~ saw.promotion + existing.customer + hour.of.day, 
             data = webdata, 
             family = binomial)
</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
